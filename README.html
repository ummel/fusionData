<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="pandoc">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="data:text/css,%0A%40font%2Dface%20%7B%0Afont%2Dfamily%3A%20octicons%2Dlink%3B%0Asrc%3A%20url%28data%3Afont%2Fwoff%3Bcharset%3Dutf%2D8%3Bbase64%2Cd09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM%2B8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB%2FaFGpk3jaTY6xa8JAGMW%2FO62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v%2Bk%2F0an2i%2BitHDw3v2%2B9%2BDBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3%2FI7AtxEJLtzzuZfI%2BVVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy%2FLt7Kc%2B0vWY%2FgAgIIEqAN9we0pwKXreiMasxvabDQMM4riO%2BqxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw%2Bymhce7vwM9jSqO8JyVd5RH9gyTt2%2BJ%2FyUmYlIR0s04n6%2B7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv%2FocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi%2BW2%2BMjCzMIDApSwvXzC97Z4Ig8N%2FBxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh%2F8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT%2BAEjAwuDFpBmA9KMDEwMCh9i%2Fv8H8sH0%2F4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9%2FlqYwOGZxeUelN2U2R6%2BcArgtCJpauW7UQBqnFkUsjAY%2FkOU1cP%2BDAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl%2BvvmM%2FbyA48e6tWrKArm4ZJlCbdsrxksL1AwWn%2FyBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO%2F%2FsdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd%2F89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF%2B9JOS0nbaaYDCQfwCJ7Au3AHj%2BLO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm%2BEBXuAbHmIMSRMs%2B4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL%2BhD7C1xoaHeLJSEao0FEW14ckxC%2BTU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13%2F%2Blm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl%2B9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O%2FAdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB%2F%2F%2FAA8AAQAAAAAAAAAAAAAAAAABAAAAAA%3D%3D%29%20format%28%27woff%27%29%3B%0A%7D%0Abody%20%7B%0A%2Dwebkit%2Dtext%2Dsize%2Dadjust%3A%20100%25%3B%0Atext%2Dsize%2Dadjust%3A%20100%25%3B%0Acolor%3A%20%23333%3B%0Afont%2Dfamily%3A%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20%22Segoe%20UI%22%2C%20Arial%2C%20freesans%2C%20sans%2Dserif%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Segoe%20UI%20Emoji%22%2C%20%22Segoe%20UI%20Symbol%22%3B%0Afont%2Dsize%3A%2016px%3B%0Aline%2Dheight%3A%201%2E6%3B%0Aword%2Dwrap%3A%20break%2Dword%3B%0A%7D%0Aa%20%7B%0Abackground%2Dcolor%3A%20transparent%3B%0A%7D%0Aa%3Aactive%2C%0Aa%3Ahover%20%7B%0Aoutline%3A%200%3B%0A%7D%0Astrong%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Ah1%20%7B%0Afont%2Dsize%3A%202em%3B%0Amargin%3A%200%2E67em%200%3B%0A%7D%0Aimg%20%7B%0Aborder%3A%200%3B%0A%7D%0Ahr%20%7B%0Abox%2Dsizing%3A%20content%2Dbox%3B%0Aheight%3A%200%3B%0A%7D%0Apre%20%7B%0Aoverflow%3A%20auto%3B%0A%7D%0Acode%2C%0Akbd%2C%0Apre%20%7B%0Afont%2Dfamily%3A%20monospace%2C%20monospace%3B%0Afont%2Dsize%3A%201em%3B%0A%7D%0Ainput%20%7B%0Acolor%3A%20inherit%3B%0Afont%3A%20inherit%3B%0Amargin%3A%200%3B%0A%7D%0Ahtml%20input%5Bdisabled%5D%20%7B%0Acursor%3A%20default%3B%0A%7D%0Ainput%20%7B%0Aline%2Dheight%3A%20normal%3B%0A%7D%0Ainput%5Btype%3D%22checkbox%22%5D%20%7B%0Abox%2Dsizing%3A%20border%2Dbox%3B%0Apadding%3A%200%3B%0A%7D%0Atable%20%7B%0Aborder%2Dcollapse%3A%20collapse%3B%0Aborder%2Dspacing%3A%200%3B%0A%7D%0Atd%2C%0Ath%20%7B%0Apadding%3A%200%3B%0A%7D%0A%2A%20%7B%0Abox%2Dsizing%3A%20border%2Dbox%3B%0A%7D%0Ainput%20%7B%0Afont%3A%2013px%20%2F%201%2E4%20Helvetica%2C%20arial%2C%20nimbussansl%2C%20liberationsans%2C%20freesans%2C%20clean%2C%20sans%2Dserif%2C%20%22Apple%20Color%20Emoji%22%2C%20%22Segoe%20UI%20Emoji%22%2C%20%22Segoe%20UI%20Symbol%22%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%234078c0%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%2C%0Aa%3Aactive%20%7B%0Atext%2Ddecoration%3A%20underline%3B%0A%7D%0Ahr%20%7B%0Aheight%3A%200%3B%0Amargin%3A%2015px%200%3B%0Aoverflow%3A%20hidden%3B%0Abackground%3A%20transparent%3B%0Aborder%3A%200%3B%0Aborder%2Dbottom%3A%201px%20solid%20%23ddd%3B%0A%7D%0Ahr%3Abefore%20%7B%0Adisplay%3A%20table%3B%0Acontent%3A%20%22%22%3B%0A%7D%0Ahr%3Aafter%20%7B%0Adisplay%3A%20table%3B%0Aclear%3A%20both%3B%0Acontent%3A%20%22%22%3B%0A%7D%0Ah1%2C%0Ah2%2C%0Ah3%2C%0Ah4%2C%0Ah5%2C%0Ah6%20%7B%0Amargin%2Dtop%3A%2015px%3B%0Amargin%2Dbottom%3A%2015px%3B%0Aline%2Dheight%3A%201%2E1%3B%0A%7D%0Ah1%20%7B%0Afont%2Dsize%3A%2030px%3B%0A%7D%0Ah2%20%7B%0Afont%2Dsize%3A%2021px%3B%0A%7D%0Ah3%20%7B%0Afont%2Dsize%3A%2016px%3B%0A%7D%0Ah4%20%7B%0Afont%2Dsize%3A%2014px%3B%0A%7D%0Ah5%20%7B%0Afont%2Dsize%3A%2012px%3B%0A%7D%0Ah6%20%7B%0Afont%2Dsize%3A%2011px%3B%0A%7D%0Ablockquote%20%7B%0Amargin%3A%200%3B%0A%7D%0Aul%2C%0Aol%20%7B%0Apadding%3A%200%3B%0Amargin%2Dtop%3A%200%3B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Aol%20ol%2C%0Aul%20ol%20%7B%0Alist%2Dstyle%2Dtype%3A%20lower%2Droman%3B%0A%7D%0Aul%20ul%20ol%2C%0Aul%20ol%20ol%2C%0Aol%20ul%20ol%2C%0Aol%20ol%20ol%20%7B%0Alist%2Dstyle%2Dtype%3A%20lower%2Dalpha%3B%0A%7D%0Add%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20%22Liberation%20Mono%22%2C%20Menlo%2C%20Courier%2C%20monospace%3B%0Afont%2Dsize%3A%2012px%3B%0A%7D%0Apre%20%7B%0Amargin%2Dtop%3A%200%3B%0Amargin%2Dbottom%3A%200%3B%0Afont%3A%2012px%20Consolas%2C%20%22Liberation%20Mono%22%2C%20Menlo%2C%20Courier%2C%20monospace%3B%0A%7D%0A%2Eselect%3A%3A%2Dms%2Dexpand%20%7B%0Aopacity%3A%200%3B%0A%7D%0A%2Eocticon%20%7B%0Afont%3A%20normal%20normal%20normal%2016px%2F1%20octicons%2Dlink%3B%0Adisplay%3A%20inline%2Dblock%3B%0Atext%2Ddecoration%3A%20none%3B%0Atext%2Drendering%3A%20auto%3B%0A%2Dwebkit%2Dfont%2Dsmoothing%3A%20antialiased%3B%0A%2Dmoz%2Dosx%2Dfont%2Dsmoothing%3A%20grayscale%3B%0A%2Dwebkit%2Duser%2Dselect%3A%20none%3B%0A%2Dmoz%2Duser%2Dselect%3A%20none%3B%0A%2Dms%2Duser%2Dselect%3A%20none%3B%0Auser%2Dselect%3A%20none%3B%0A%7D%0A%2Eocticon%2Dlink%3Abefore%20%7B%0Acontent%3A%20%27%5Cf05c%27%3B%0A%7D%0A%2Emarkdown%2Dbody%3Abefore%20%7B%0Adisplay%3A%20table%3B%0Acontent%3A%20%22%22%3B%0A%7D%0A%2Emarkdown%2Dbody%3Aafter%20%7B%0Adisplay%3A%20table%3B%0Aclear%3A%20both%3B%0Acontent%3A%20%22%22%3B%0A%7D%0A%2Emarkdown%2Dbody%3E%2A%3Afirst%2Dchild%20%7B%0Amargin%2Dtop%3A%200%20%21important%3B%0A%7D%0A%2Emarkdown%2Dbody%3E%2A%3Alast%2Dchild%20%7B%0Amargin%2Dbottom%3A%200%20%21important%3B%0A%7D%0Aa%3Anot%28%5Bhref%5D%29%20%7B%0Acolor%3A%20inherit%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0A%2Eanchor%20%7B%0Adisplay%3A%20inline%2Dblock%3B%0Apadding%2Dright%3A%202px%3B%0Amargin%2Dleft%3A%20%2D18px%3B%0A%7D%0A%2Eanchor%3Afocus%20%7B%0Aoutline%3A%20none%3B%0A%7D%0Ah1%2C%0Ah2%2C%0Ah3%2C%0Ah4%2C%0Ah5%2C%0Ah6%20%7B%0Amargin%2Dtop%3A%201em%3B%0Amargin%2Dbottom%3A%2016px%3B%0Afont%2Dweight%3A%20bold%3B%0Aline%2Dheight%3A%201%2E4%3B%0A%7D%0Ah1%20%2Eocticon%2Dlink%2C%0Ah2%20%2Eocticon%2Dlink%2C%0Ah3%20%2Eocticon%2Dlink%2C%0Ah4%20%2Eocticon%2Dlink%2C%0Ah5%20%2Eocticon%2Dlink%2C%0Ah6%20%2Eocticon%2Dlink%20%7B%0Acolor%3A%20%23000%3B%0Avertical%2Dalign%3A%20middle%3B%0Avisibility%3A%20hidden%3B%0A%7D%0Ah1%3Ahover%20%2Eanchor%2C%0Ah2%3Ahover%20%2Eanchor%2C%0Ah3%3Ahover%20%2Eanchor%2C%0Ah4%3Ahover%20%2Eanchor%2C%0Ah5%3Ahover%20%2Eanchor%2C%0Ah6%3Ahover%20%2Eanchor%20%7B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Ah1%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah2%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah3%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah4%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah5%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%2C%0Ah6%3Ahover%20%2Eanchor%20%2Eocticon%2Dlink%20%7B%0Avisibility%3A%20visible%3B%0A%7D%0Ah1%20%7B%0Apadding%2Dbottom%3A%200%2E3em%3B%0Afont%2Dsize%3A%202%2E25em%3B%0Aline%2Dheight%3A%201%2E2%3B%0Aborder%2Dbottom%3A%201px%20solid%20%23eee%3B%0A%7D%0Ah1%20%2Eanchor%20%7B%0Aline%2Dheight%3A%201%3B%0A%7D%0Ah2%20%7B%0Apadding%2Dbottom%3A%200%2E3em%3B%0Afont%2Dsize%3A%201%2E75em%3B%0Aline%2Dheight%3A%201%2E225%3B%0Aborder%2Dbottom%3A%201px%20solid%20%23eee%3B%0A%7D%0Ah2%20%2Eanchor%20%7B%0Aline%2Dheight%3A%201%3B%0A%7D%0Ah3%20%7B%0Afont%2Dsize%3A%201%2E5em%3B%0Aline%2Dheight%3A%201%2E43%3B%0A%7D%0Ah3%20%2Eanchor%20%7B%0Aline%2Dheight%3A%201%2E2%3B%0A%7D%0Ah4%20%7B%0Afont%2Dsize%3A%201%2E25em%3B%0A%7D%0Ah4%20%2Eanchor%20%7B%0Aline%2Dheight%3A%201%2E2%3B%0A%7D%0Ah5%20%7B%0Afont%2Dsize%3A%201em%3B%0A%7D%0Ah5%20%2Eanchor%20%7B%0Aline%2Dheight%3A%201%2E1%3B%0A%7D%0Ah6%20%7B%0Afont%2Dsize%3A%201em%3B%0Acolor%3A%20%23777%3B%0A%7D%0Ah6%20%2Eanchor%20%7B%0Aline%2Dheight%3A%201%2E1%3B%0A%7D%0Ap%2C%0Ablockquote%2C%0Aul%2C%0Aol%2C%0Adl%2C%0Atable%2C%0Apre%20%7B%0Amargin%2Dtop%3A%200%3B%0Amargin%2Dbottom%3A%2016px%3B%0A%7D%0Ahr%20%7B%0Aheight%3A%204px%3B%0Apadding%3A%200%3B%0Amargin%3A%2016px%200%3B%0Abackground%2Dcolor%3A%20%23e7e7e7%3B%0Aborder%3A%200%20none%3B%0A%7D%0Aul%2C%0Aol%20%7B%0Apadding%2Dleft%3A%202em%3B%0A%7D%0Aul%20ul%2C%0Aul%20ol%2C%0Aol%20ol%2C%0Aol%20ul%20%7B%0Amargin%2Dtop%3A%200%3B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Ali%3Ep%20%7B%0Amargin%2Dtop%3A%2016px%3B%0A%7D%0Adl%20%7B%0Apadding%3A%200%3B%0A%7D%0Adl%20dt%20%7B%0Apadding%3A%200%3B%0Amargin%2Dtop%3A%2016px%3B%0Afont%2Dsize%3A%201em%3B%0Afont%2Dstyle%3A%20italic%3B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Adl%20dd%20%7B%0Apadding%3A%200%2016px%3B%0Amargin%2Dbottom%3A%2016px%3B%0A%7D%0Ablockquote%20%7B%0Apadding%3A%200%2015px%3B%0Acolor%3A%20%23777%3B%0Aborder%2Dleft%3A%204px%20solid%20%23ddd%3B%0A%7D%0Ablockquote%3E%3Afirst%2Dchild%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Ablockquote%3E%3Alast%2Dchild%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Atable%20%7B%0Adisplay%3A%20block%3B%0Awidth%3A%20100%25%3B%0Aoverflow%3A%20auto%3B%0Aword%2Dbreak%3A%20normal%3B%0Aword%2Dbreak%3A%20keep%2Dall%3B%0A%7D%0Atable%20th%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Atable%20th%2C%0Atable%20td%20%7B%0Apadding%3A%206px%2013px%3B%0Aborder%3A%201px%20solid%20%23ddd%3B%0A%7D%0Atable%20tr%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Aborder%2Dtop%3A%201px%20solid%20%23ccc%3B%0A%7D%0Atable%20tr%3Anth%2Dchild%282n%29%20%7B%0Abackground%2Dcolor%3A%20%23f8f8f8%3B%0A%7D%0Aimg%20%7B%0Amax%2Dwidth%3A%20100%25%3B%0Abox%2Dsizing%3A%20content%2Dbox%3B%0Abackground%2Dcolor%3A%20%23fff%3B%0A%7D%0Acode%20%7B%0Apadding%3A%200%3B%0Apadding%2Dtop%3A%200%2E2em%3B%0Apadding%2Dbottom%3A%200%2E2em%3B%0Amargin%3A%200%3B%0Afont%2Dsize%3A%2085%25%3B%0Abackground%2Dcolor%3A%20rgba%280%2C0%2C0%2C0%2E04%29%3B%0Aborder%2Dradius%3A%203px%3B%0A%7D%0Acode%3Abefore%2C%0Acode%3Aafter%20%7B%0Aletter%2Dspacing%3A%20%2D0%2E2em%3B%0Acontent%3A%20%22%5C00a0%22%3B%0A%7D%0Apre%3Ecode%20%7B%0Apadding%3A%200%3B%0Amargin%3A%200%3B%0Afont%2Dsize%3A%20100%25%3B%0Aword%2Dbreak%3A%20normal%3B%0Awhite%2Dspace%3A%20pre%3B%0Abackground%3A%20transparent%3B%0Aborder%3A%200%3B%0A%7D%0A%2Ehighlight%20%7B%0Amargin%2Dbottom%3A%2016px%3B%0A%7D%0A%2Ehighlight%20pre%2C%0Apre%20%7B%0Apadding%3A%2016px%3B%0Aoverflow%3A%20auto%3B%0Afont%2Dsize%3A%2085%25%3B%0Aline%2Dheight%3A%201%2E45%3B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0A%7D%0A%2Ehighlight%20pre%20%7B%0Amargin%2Dbottom%3A%200%3B%0Aword%2Dbreak%3A%20normal%3B%0A%7D%0Apre%20%7B%0Aword%2Dwrap%3A%20normal%3B%0A%7D%0Apre%20code%20%7B%0Adisplay%3A%20inline%3B%0Amax%2Dwidth%3A%20initial%3B%0Apadding%3A%200%3B%0Amargin%3A%200%3B%0Aoverflow%3A%20initial%3B%0Aline%2Dheight%3A%20inherit%3B%0Aword%2Dwrap%3A%20normal%3B%0Abackground%2Dcolor%3A%20transparent%3B%0Aborder%3A%200%3B%0A%7D%0Apre%20code%3Abefore%2C%0Apre%20code%3Aafter%20%7B%0Acontent%3A%20normal%3B%0A%7D%0Akbd%20%7B%0Adisplay%3A%20inline%2Dblock%3B%0Apadding%3A%203px%205px%3B%0Afont%2Dsize%3A%2011px%3B%0Aline%2Dheight%3A%2010px%3B%0Acolor%3A%20%23555%3B%0Avertical%2Dalign%3A%20middle%3B%0Abackground%2Dcolor%3A%20%23fcfcfc%3B%0Aborder%3A%20solid%201px%20%23ccc%3B%0Aborder%2Dbottom%2Dcolor%3A%20%23bbb%3B%0Aborder%2Dradius%3A%203px%3B%0Abox%2Dshadow%3A%20inset%200%20%2D1px%200%20%23bbb%3B%0A%7D%0A%2Epl%2Dc%20%7B%0Acolor%3A%20%23969896%3B%0A%7D%0A%2Epl%2Dc1%2C%0A%2Epl%2Ds%20%2Epl%2Dv%20%7B%0Acolor%3A%20%230086b3%3B%0A%7D%0A%2Epl%2De%2C%0A%2Epl%2Den%20%7B%0Acolor%3A%20%23795da3%3B%0A%7D%0A%2Epl%2Ds%20%2Epl%2Ds1%2C%0A%2Epl%2Dsmi%20%7B%0Acolor%3A%20%23333%3B%0A%7D%0A%2Epl%2Dent%20%7B%0Acolor%3A%20%2363a35c%3B%0A%7D%0A%2Epl%2Dk%20%7B%0Acolor%3A%20%23a71d5d%3B%0A%7D%0A%2Epl%2Dpds%2C%0A%2Epl%2Ds%2C%0A%2Epl%2Ds%20%2Epl%2Dpse%20%2Epl%2Ds1%2C%0A%2Epl%2Dsr%2C%0A%2Epl%2Dsr%20%2Epl%2Dcce%2C%0A%2Epl%2Dsr%20%2Epl%2Dsra%2C%0A%2Epl%2Dsr%20%2Epl%2Dsre%20%7B%0Acolor%3A%20%23183691%3B%0A%7D%0A%2Epl%2Dv%20%7B%0Acolor%3A%20%23ed6a43%3B%0A%7D%0A%2Epl%2Did%20%7B%0Acolor%3A%20%23b52a1d%3B%0A%7D%0A%2Epl%2Dii%20%7B%0Abackground%2Dcolor%3A%20%23b52a1d%3B%0Acolor%3A%20%23f8f8f8%3B%0A%7D%0A%2Epl%2Dsr%20%2Epl%2Dcce%20%7B%0Acolor%3A%20%2363a35c%3B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0A%2Epl%2Dml%20%7B%0Acolor%3A%20%23693a17%3B%0A%7D%0A%2Epl%2Dmh%2C%0A%2Epl%2Dmh%20%2Epl%2Den%2C%0A%2Epl%2Dms%20%7B%0Acolor%3A%20%231d3e81%3B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0A%2Epl%2Dmq%20%7B%0Acolor%3A%20%23008080%3B%0A%7D%0A%2Epl%2Dmi%20%7B%0Acolor%3A%20%23333%3B%0Afont%2Dstyle%3A%20italic%3B%0A%7D%0A%2Epl%2Dmb%20%7B%0Acolor%3A%20%23333%3B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0A%2Epl%2Dmd%20%7B%0Abackground%2Dcolor%3A%20%23ffecec%3B%0Acolor%3A%20%23bd2c00%3B%0A%7D%0A%2Epl%2Dmi1%20%7B%0Abackground%2Dcolor%3A%20%23eaffea%3B%0Acolor%3A%20%2355a532%3B%0A%7D%0A%2Epl%2Dmdr%20%7B%0Acolor%3A%20%23795da3%3B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0A%2Epl%2Dmo%20%7B%0Acolor%3A%20%231d3e81%3B%0A%7D%0Akbd%20%7B%0Adisplay%3A%20inline%2Dblock%3B%0Apadding%3A%203px%205px%3B%0Afont%3A%2011px%20Consolas%2C%20%22Liberation%20Mono%22%2C%20Menlo%2C%20Courier%2C%20monospace%3B%0Aline%2Dheight%3A%2010px%3B%0Acolor%3A%20%23555%3B%0Avertical%2Dalign%3A%20middle%3B%0Abackground%2Dcolor%3A%20%23fcfcfc%3B%0Aborder%3A%20solid%201px%20%23ccc%3B%0Aborder%2Dbottom%2Dcolor%3A%20%23bbb%3B%0Aborder%2Dradius%3A%203px%3B%0Abox%2Dshadow%3A%20inset%200%20%2D1px%200%20%23bbb%3B%0A%7D%0A%2Etask%2Dlist%2Ditem%20%7B%0Alist%2Dstyle%2Dtype%3A%20none%3B%0A%7D%0A%2Etask%2Dlist%2Ditem%2B%2Etask%2Dlist%2Ditem%20%7B%0Amargin%2Dtop%3A%203px%3B%0A%7D%0A%2Etask%2Dlist%2Ditem%20input%20%7B%0Amargin%3A%200%200%2E35em%200%2E25em%20%2D1%2E6em%3B%0Avertical%2Dalign%3A%20middle%3B%0A%7D%0A%3Achecked%2B%2Eradio%2Dlabel%20%7B%0Az%2Dindex%3A%201%3B%0Aposition%3A%20relative%3B%0Aborder%2Dcolor%3A%20%234078c0%3B%0A%7D%0A%2EsourceLine%20%7B%0Adisplay%3A%20inline%2Dblock%3B%0A%7D%0Acode%20%2Ekw%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%2Edt%20%7B%20color%3A%20%23ed6a43%3B%20%7D%0Acode%20%2Edv%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%2Ebn%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%2Efl%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%2Ech%20%7B%20color%3A%20%23009999%3B%20%7D%0Acode%20%2Est%20%7B%20color%3A%20%23183691%3B%20%7D%0Acode%20%2Eco%20%7B%20color%3A%20%23969896%3B%20%7D%0Acode%20%2Eot%20%7B%20color%3A%20%230086b3%3B%20%7D%0Acode%20%2Eal%20%7B%20color%3A%20%23a61717%3B%20%7D%0Acode%20%2Efu%20%7B%20color%3A%20%2363a35c%3B%20%7D%0Acode%20%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%0Acode%20%2Ewa%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%2Ecn%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%2Esc%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%2Evs%20%7B%20color%3A%20%23183691%3B%20%7D%0Acode%20%2Ess%20%7B%20color%3A%20%23183691%3B%20%7D%0Acode%20%2Eim%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%2Eva%20%7Bcolor%3A%20%23008080%3B%20%7D%0Acode%20%2Ecf%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%2Eop%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%2Ebu%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%2Eex%20%7B%20color%3A%20%23000000%3B%20%7D%0Acode%20%2Epp%20%7B%20color%3A%20%23999999%3B%20%7D%0Acode%20%2Eat%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%2Edo%20%7B%20color%3A%20%23969896%3B%20%7D%0Acode%20%2Ean%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%2Ecv%20%7B%20color%3A%20%23008080%3B%20%7D%0Acode%20%2Ein%20%7B%20color%3A%20%23008080%3B%20%7D%0A">
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<h1 id="fusiondata">fusionData</h1>
<p>Kevin Ummel (<a href="mailto:ummel@sas.upenn.edu">ummel@sas.upenn.edu</a>)</p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#setup-and-install">Setup and install</a></li>
<li><a href="#usage-and-structure">Usage and structure</a></li>
<li><a href="#ingest-survey-data">Ingest survey data</a></li>
<li><a href="#document-variables">Document variables</a></li>
<li><a href="#harmonize-variables">Harmonize variables</a></li>
<li><a href="#compile-spatial-data">Compile spatial data</a></li>
<li><a href="#prepare-for-fusion">Prepare for fusion</a></li>
<li><a href="#make-it-rain">Make it rain</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p><strong>fusionData</strong> is used to create and manage the data 
inputs underpinning the larger fusionACS platform. It facilitates a 
number of steps in the overall fusionACS workflow:</p>
<ol style="list-style-type: decimal">
<li><strong>Ingest</strong>: Process raw survey data using a standard approach and formatting.</li>
<li><strong>Document</strong>: Document survey variables and compile a “universal” data dictionary.</li>
<li><strong>Harmonize</strong>: Harmonize variables in “donor” surveys with those in the American Community Survey (ACS).</li>
<li><strong>Compile spatial data</strong>: Compile data from multiple spatial datasets for merging with survey microdata.</li>
<li><strong>Prepare for fusion</strong>: Prepare donor and ACS/recipient microdata inputs passed to the <a href="https://github.com/ummel/fusionModel">fusionModel package</a>.</li>
</ol>
<h2 id="setup-and-install">Setup and install</h2>
<p>The fusionData <em>master</em> branch can be cloned to its own project directory on your local machine using RStudio and <a href="https://book.cds101.com/using-rstudio-server-to-clone-a-github-repo-as-a-new-project.html">these instructions</a>.</p>
<p>Use the following setup parameters:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Repository URL<span class="sc">:</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ummel<span class="sc">/</span>fusionData</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Project directory name<span class="sc">:</span> fusionData</span></code></pre></div>
<p>You will be prompted to enter your Github username and password. 
After the repository has been cloned to your local project directory, 
you can install and load the package itself. You may be prompted to 
install some dependencies.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install the fusionData package locally</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load fusionData package</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fusionData)</span></code></pre></div>
<p>For full functionality, it is necessary to download the 
remotely-stored processed survey microdata and processed spatial data 
files. The following section (“Structure and usage”) has more detail 
about this and the associated reasoning. See <code>?getSurveyProcessed</code> and <code>?getGeoProcessed</code> as well. To get up and running, you’ll need to call the following commands.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download all remote processed survey microdata files</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getSurveyProcessed</span>(<span class="at">survey =</span> <span class="st">"all"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download only the essential remote spatial data files</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">getGeoProcessed</span>(<span class="at">dataset =</span> <span class="st">"essential"</span>)</span></code></pre></div>
<p>You will be prompted to enter the password for the Google Drive account storing the remote files.</p>
<ul>
<li>username: fusionACSdata</li>
<li>password: fusethis!</li>
</ul>
<p>The download will take a few minutes. The files are automatically placed in the appropriate sub-directories of <code>/fusionData</code>, with the directories created if necessary. After successful download, your fusionData “system” is ready to go.</p>
<h2 id="usage-and-structure">Usage and structure</h2>
<p>Although fusionData is structured (and loadable) as a R package, it is better to think of it as a code and data <em>repository</em>
 that is shared and continuously modified by authorized users. 
fusionData is expected to grow over time as new surveys and spatial 
datasets – and the code needed to process and manipulate them – are 
added. fusionData is <em>not public</em>.</p>
<p>As you modify code and files in your local <code>/fusionData</code> 
project directory, you will need to commit and push those changes to the
 Github repository for them to be accessible to other users. In 
addition, it is good practice to pull the latest version of the 
repository from Github prior to making any modifications. That way, you 
know you are working from the latest shared version.</p>
<p>Since Github places limits on file/repository size, I decided to 
store certain data files “remotely” – that is, outside of the Github 
repository. Specifically, the lowest-level “raw” data inputs and the 
associated “processed” versions of that data (details below). Over time,
 it is expected that these types of data files could become quite large 
in the aggregate.</p>
<p>The remotely-stored “raw” and “processed” data files are integral to 
the overall fusionData “system”, but they are not present in the Github 
repository itself. Instead, the remote files (and associated directory 
structure) are stored in Google Drive and can be automatically and 
safely added to a user’s <em>local</em> fusionData folder using provided
 functions. Once the remote files are added, the user’s local fusionData
 package is fully functional.</p>
<p>Remote data files should be rather static over time. So, it is 
expected that a user will need to update (re-download) the remote files 
to their local fusionData directory only infrequently. However, when 
users add or modify <em>code</em> (or smaller, ancillary data files), 
the changes are then pushed to the Github repository where they become 
subject to code reviews, versioning control, and accessible to other 
authorized users.</p>
<p>In short: The Github repository stores any and all code needed to 
build and document the fusionData architecture. But certain, 
infrequently-modified data files are stored remotely. Users can add the 
remote files to their local installation of fusionData and only code and
 ancillary data files are pushed to Github when modified.</p>
<p>Changes or additions to the remote files is likely to be rare, and will be done “by hand” to prevent any inadvertent changes.</p>
<p>Below is an overview of the top-level directories in the fusionData 
repository, including both Github-based and “remote” elements.</p>
<h3 id="r"><code>/R</code></h3>
<p><code>.R</code> scripts defining functions for doing “fusionData things”. Not all are exported.</p>
<h3 id="data"><code>/data</code></h3>
<p>Shared, package-wide <code>.rda</code> data files. Loadable via <code>data()</code>, as usual for R packages.</p>
<h3 id="data-raw"><code>/data-raw</code></h3>
<p><code>.R</code> scripts needed to create any package-wide <code>.rda</code> objects in <code>/data</code>, as usual for R packages.</p>
<h3 id="man"><code>/man</code></h3>
<p>Documentation (i.e.&nbsp;“manual”) of functions in <code>/R</code> and data in <code>/data</code>, as usual for R packages.</p>
<h3 id="universe"><code>/universe</code></h3>
<p>Directory for the “Universal Survey Dictionary” Shiny app. The app itself can be run by calling <code>universe()</code>.</p>
<h3 id="harmony"><code>/harmony</code></h3>
<p>Directory for the “Survey Harmonization Tool” Shiny app. The app itself can be run by calling <code>harmony()</code>.</p>
<h3 id="survey-processed"><code>/survey-processed</code></h3>
<p>Contains processed survey data and associated code. Subdirectories refer to specific surveys and vintages.</p>
<p>Example: <code>/survey-processed/RECS/2015</code></p>
<p>The Github repository version of <code>/survey-processed</code> contains two kinds of files:</p>
<ol style="list-style-type: decimal">
<li>Custom .R scripts that transform <em>raw</em> survey microdata (located in <code>/survey-raw</code>) into “processed” versions that adhere to certain requirements, structure, and naming conventions.</li>
</ol>
<p>Example: <code>/survey-processed/RECS/2015/RECS_2015_H_processed.R</code></p>
<ol style="list-style-type: decimal" start="2">
<li>“Dictionary” files (.rds) that contain standardized metadata and variable descriptions for a particular survey.</li>
</ol>
<p>Example: <code>/survey-processed/RECS/2015/RECS_2015_H_dictionary.rds</code></p>
<p><code>/survey-processed</code> also includes .fst files containing 
the processed microdata itself. These files are stored remotely and can 
be added to a user’s local fusionData directory by calling <code>getSurveyProcessed()</code>.</p>
<p>For example, the .fst file <code>/survey-processed/RECS/2015/RECS_2015_H_processed.fst</code> contains processed, household-level microdata for the 2015 RECS. The <em>code</em> that creates this file is found in <code>/survey-processed/RECS/2015/RECS_2015_H_processed.R</code>. The .R file is part of the Github repository (<a href="https://github.com/ummel/fusionData/blob/master/survey-processed/RECS/2015/RECS_2015_H_processed.R">see here</a>), but the .fst file is stored remotely.</p>
<p>Use of <a href="http://www.fstpackage.org/">.fst files</a> allows data to be read very quickly from disk, in part or in full. Functions in the fusionData package take advantage of this.</p>
<h3 id="survey-raw"><code>/survey-raw</code></h3>
<p>A remote directory (i.e.&nbsp;not present in the Github repository) containing <em>raw</em> survey data files. Subdirectories refer to specific surveys and vintages.</p>
<p>Example: <code>/survey-raw/RECS/2015</code></p>
<p><code>/survey-raw</code> can be downloaded and added to a user’s local fusionData directory by calling <code>getSurveyRaw()</code>.
 However, in practice, there is no reason for a user to store raw survey
 data locally unless it is for a survey that they are actively 
processing or editing. Once the <em>processed</em> version of a survey (<code>*_processed.fst</code>)
 is stable and uploaded to the remote Google Drive, users can access and
 use the processed version without ever needing to download or look at 
the original/raw data.</p>
<h3 id="geo-processed"><code>/geo-processed</code></h3>
<p>Contains processed spatial data and associated code. Subdirectories refer to specific spatial datasets.</p>
<p>Example: <code>/geo-processed/EPA-SLD</code></p>
<p>The Github repository version of <code>/geo-processed</code> contains the following kinds of files:</p>
<ol style="list-style-type: decimal">
<li>Custom <code>.R</code> scripts that transform <em>raw</em> spatial data (located in <code>/geo-raw</code>) into processed .rds files that meet certain requirements.</li>
</ol>
<p>Example: <code>/geo-processed/EPA-SLD/epa-sld_v3_processed.R</code></p>
<p><code>/geo-processed</code> also includes .rds files containing the 
processed spatial data itself. These files are stored remotely and can 
be added to a user’s local fusionData directory by calling <code>getGeoProcessed()</code>.</p>
<p>For example, the .rds file <code>/geo-processed/EPA-SLD/epa-sld_v3_processed.rds</code> contains processed spatial variables from version 3 of the EPA’s <a href="https://www.epa.gov/smartgrowth/smart-location-mapping#SLD">Smart Location Database (SLD)</a>. The <em>code</em> that creates this file is found in <code>/geo-processed/EPA-SLD/epa-sld_v3_processed.R</code>. The .R file is part of the Github repository (<a href="https://github.com/ummel/fusionData/blob/master/geo-processed/EPA-SLD/epa-sld_v3_processed.R">see here</a>), but the .rds file is stored remotely.</p>
<p>Importantly, the <code>/geo-processed</code> remote content <em>also</em>
 includes three “essential” spatial data files that are, in practice, 
all that most users will need to perform data fusion locally. These 
files and their roles are described in more detail later on.</p>
<ol style="list-style-type: decimal">
<li><code>geo_predictors.fst</code></li>
<li><code>concordance/geo_concordance.fst</code></li>
</ol>
<p>For users who are not modifying or adding spatial datasets, it is sufficient to call <code>getGeoProcessed(dataset = "essential")</code> to load the essential “geo” files.</p>
<h3 id="geo-raw"><code>/geo-raw</code></h3>
<p>A remote directory (i.e.&nbsp;not present in the Github repository) containing <em>raw</em> spatial data files. Subdirectories refer to specific spatial datasets.</p>
<p>Example: <code>/geo-raw/EPA-SLD</code></p>
<p><code>/geo-raw</code> can be downloaded and added to a user’s local fusionData directory by calling <code>getGeoRaw()</code>.
 However, in practice, there is no reason for a user to store raw 
spatial data locally unless it is for a spatial dataset that they are 
actively processing or editing.</p>
<h3 id="production"><code>/production</code></h3>
<p>Directory containing code and possibly data from “production” fusion 
runs. This is likely a temporary inclusion. As additional fusion results
 are produced, we should create a more structured way of storing and 
organizing production data outputs.</p>
<h2 id="ingest-survey-data">Ingest survey data</h2>
<p>“Ingesting” a survey requires transforming raw survey data into 
“processed” (i.e.&nbsp;standardized) microdata files that meet certain 
requirements. The fusionData codebase depends on the processed microdata
 having recognizable structure and features.</p>
<p>The ingestion process for each survey is documented and defined by a 
.R script (possibly multiple scripts) that must be written manually. The
 goal is to produce a data.frame containing microdata observations that 
(ideally) meet the following conditions:</p>
<ul>
<li>Contains as many observations and variables as possible.</li>
<li>Variable names and descriptions are taken from the official codebook, possibly modified for clarity.</li>
<li>Official variable names are coerced to lower-case alphanumeric, possibly using single underscores.</li>
<li>Codes used in the raw data are replaced with descriptive labels from
 the codebook; e.g.&nbsp;integer values are replaced with associated 
factor levels.</li>
<li>All “valid blanks” in the raw data are set to plausible values; NA’s
 are often actual zeros or some other knowable value based on the 
question structure.</li>
<li>All “invalid blanks” or missing values in the raw data are imputed; a generic imputation function is provided for this purpose.</li>
<li>Ordered factors are used and defined whenever possible (as opposed to unordered).</li>
<li>Standard column names are used for unique household identifiers 
(e.g.&nbsp;“acs_2019_hid”); for person-level microdata the 
within-household person identifier (integer) is always “pid”.</li>
<li>Standard column names are used for observation weights; “weight” for
 the primary weighting variable and “rep_1”, etc. for replicate weights.</li>
<li>Variables identifying respondent location are consistent with those defined in <code>geo-processed/concordance/geo_concordance.fst</code>.</li>
</ul>
<p>Let’s look at a few of the variables in the processed RECS 2015 
microdata to get a sense of what preferred output looks like. Note that 
the file name includes a <code>_H_</code> identifier, indicating that 
the microdata in question is household-level. Surveys that include both 
household and person-level respondent information have two such files – 
both “H” and “P” microdata. The RECS has only household (“H”) microdata.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>recs <span class="ot">&lt;-</span> fst<span class="sc">::</span><span class="fu">read_fst</span>(<span class="st">"survey-processed/RECS/2015/RECS_2015_H_processed.fst"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(recs, recs_2015_hid, weight, rep_1, sizeofgarage, recs_iecc_zone))</span></code></pre></div>
<pre><code>  recs_2015_hid weight rep_1   sizeofgarage           recs_iecc_zone
1         10001  12090 16560 Two-car garage IECC climate zones 3B-4B
2         10002  14400 21500      No garage IECC climate zones 1A-2A
3         10003  23330 12300      No garage     IECC climate zone 3A
4         10004  12170 18550 Two-car garage     IECC climate zone 4A
5         10005  16720  8080 One-car garage     IECC climate zone 5A
6         10006  26060 37000      No garage IECC climate zones 6A-6B</code></pre>
<p>Notice that the household ID variable has a standardized name 
(“recs_2015_hid”), as does the observation weights column (“weight”) and
 the first of the 96 replicate weights (“rep_1”). If the microdata 
consisted of person-level observations nested within households 
(e.g.&nbsp;as in the ACS), it would have have an additional “pid” 
integer variable to uniquely identify each person within the household.</p>
<p>In the case of “sizeofgarage” (the original variable name in RECS), 
the raw data contained NA’s (valid “skips”) for households without a 
garage. Those blanks are replaced with an intelligible label (“No 
garage”). In addition, “sizeofgarage” is classed as an ordered factor, 
since the labels have a natural ordering.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(recs<span class="sc">$</span>sizeofgarage)</span></code></pre></div>
<pre><code>[1] "ordered" "factor" </code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(recs<span class="sc">$</span>sizeofgarage)</span></code></pre></div>
<pre><code>[1] "No garage"                "One-car garage"          
[3] "Two-car garage"           "Three-or-more-car garage"</code></pre>
<p>The variable “recs_iecc_zone” tells us something about each respondent’s location (<a href="https://basc.pnnl.gov/images/iecc-climate-zone-map">IECC climate zone</a>). This and other spatially-referenced variables are defined and named to be consistent with variables in the <code>geo-processed/concordance/geo_concordance.fst</code>
 file. This allows subsequent operations to intelligently impute 
respondent location prior to fusion. More details on spatial data and 
location imputation can be found in subsequent sections.</p>
<p>It is important that the location variables in a donor survey be precisely consistent with those defined in <code>geo_concordance.fst</code>.
 The latter file can be modified, if necessary, to add new location 
variables to allow such concordance. It is only strictly necessary that 
the donor survey include the variable (or set of variables) that provide
 maximum information about respondent location. For example, if a survey
 contained a “county” variable, there is no reason to include “state” – 
though the code shouldn’t break if it is included.</p>
<p>Some surveys (like RECS) have a complicated combination of location 
variables that collectively define respondent location through their 
spatial intersection. fusionData’s code base automatically handles this,
 provided that the location variables are consistent (i.e.&nbsp;same 
name and levels) in both the donor microdata and the <code>geo_concordance.fst</code>
 file. There is no need to specify which variables are the location 
variables; this is determined automatically by looking for overlap with 
column names in the <code>geo_concordance.fst</code> file.</p>
<p>You can see how, exactly, the raw survey data was transformed by viewing the associated code in <code>/survey-processed/RECS/2015/RECS_2015_H_processed.R</code>.</p>
<p>Given the variety of survey data structures and conventions, there is
 no strict procedure for how the .R file should be written. However, 
there are common steps and tools likely to be applicable to most 
surveys. The <code>RECS_2015_H_processed.R</code> script is a good 
“template” in this regard, since it includes many common operations – 
including imputation of NA’s using the provided <code>imputeMissing()</code> function.</p>
<p>The RECS 2015 has a comparatively simple microdata and documentation 
structure: household-level microdata in a single .csv file with an 
associated .xls codebook. Other surveys require more complex steps to 
assemble the necessary microdata. There is no limit on the number or 
nature of .R files that can be used to ingest a survey. If multiple .R 
files are used, the file names should include a two-digit sequence at 
the front to indicate the order in which the scripts are employed (<code>01*.R</code>, <code>02*.R</code>, etc.).</p>
<p><em>The .R files should include liberal use of comments to help 
others understand the code later. Good practice is for comments to 
explain <strong>why</strong> a piece of code is included, not just <strong>what</strong> it does.</em></p>
<p>In all cases, the .R script that eventually saves the <code>_processed.fst</code> microdata file to disk must include the use of <code>labelled::set_variable_labels</code> to assign variable descriptions (ideally, taken from the official codebook) for each column. The script must then call the <code>createDictionary()</code> function to create and save a standardized “dictionary.rds” file. <code>createDictionary()</code>
 uses the assigned variable descriptions and other information in the 
microdata to build the dictionary in a standardized way. You can see 
this at the end of <a href="https://github.com/ummel/fusionData/blob/master/survey-processed/RECS/2015/RECS_2015_H_processed.R">RECS_2015_H_processed.R</a>:</p>
<p>Here is the resulting dictionary file for RECS 2015.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>recs.dictionary <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"survey-processed/RECS/2015/RECS_2015_H_dictionary.rds"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(recs.dictionary)</span></code></pre></div>
<pre><code># A tibble: 6 × 8
  survey vintage respondent variable  description    values          type      n
  &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt; &lt;int&gt;
1 RECS   2015    H          adqinsul  Level of insu… [Not insulated… ord    5686
2 RECS   2015    H          agecdryer Age of clothe… [No clothes dr… ord    5686
3 RECS   2015    H          agecenac  Age of centra… [No central ai… ord    5686
4 RECS   2015    H          agecwash  Age of clothe… [No clothes wa… ord    5686
5 RECS   2015    H          agedw     Age of dishwa… [No dishwasher… ord    5686
6 RECS   2015    H          agefrzr   Age of most-u… [No freezer], … ord    5686</code></pre>
<p>In practice, there is no reason for a typical user to ever open a 
survey’s dictionary file. The preferred and much more useful way to 
explore survey metadata and variable descriptions is via the <code>universe()</code> function described in the next section.</p>
<p><em>As of August 2021, American Community Survey (ACS) microdata has been ingested for 2015 and 2019.</em>
 It is expected that additional vintages will eventually be added to 
allow temporal alignment with the further vintages of donor surveys. The
 .R scripts used to process the 2015 and 2019 ACS microdata can serve as
 templates for ingesting other vintages.</p>
<h2 id="document-variables">Document variables</h2>
<p>The previous section showed how and where a survey’s “dictionary.rds”
 file(s) are created. Whenever a dictionary file is added or updated, it
 is necessary to run the <code>compileDictionary()</code> function to 
compile all of fusionData’s individual survey dictionaries into a single
 “universal” dictionary. The usage is straightforward:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compileDictionary</span>()</span></code></pre></div>
<pre><code>✓ Setting active project to '/home/kevin/Documents/Projects/fusionData'

✓ Saving 'dictionary' to 'data/dictionary.rda'

• Document your data (see 'https://r-pkgs.org/data.html')

✓ Saving 'surveys' to 'data/surveys.rda'

• Document your data (see 'https://r-pkgs.org/data.html')

dictionary.rds dimensions: 958 x 7

surveys.rds dimensions: 7 x 5</code></pre>
<p>As the console output tells us, <code>compileDictionary()</code> updates two files: <code>data/dictionary.rda</code> and <code>data/surveys.rda</code>.
 These files are part of the Github repository and are used by both the 
“Universal Survey Dictionary” and “Survey Harmonization Tool” Shiny apps
 that are part of fusionData.</p>
<p>The “Universal Survey Dictionary” is a Shiny app that can be accessed by the following call:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open "Universal Survey Dictionary" Shiny app</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">universe</span>()</span></code></pre></div>
<p>This will open the app in a browser window. The tool allows the 
“universe” of available variables – across all ingested surveys – to be 
sorted and searched. A user should consult the universal dictionary 
after initial ingestion of a new survey, because it is an effective way 
to identify variables that need additional editing.</p>
<p>We may eventually make the app public so that potential fusionACS users can browse the universe of available fusion variables.</p>
<h2 id="harmonize-variables">Harmonize variables</h2>
<p>Once a donor survey has been successfully ingested and documented, it
 is possible to start thinking about how to fuse that survey to the ACS.</p>
<p>The statistical linchpin of the fusion process is the set of 
“harmonized” variables common to a donor survey and the ACS. Identifying
 conceptually similar variables across surveys and determining how they 
can be modified to measure similar concepts is one of the most important
 steps in the process. It is also potentially time-consuming and 
error-prone.</p>
<p>The “Survey Harmonization Tool” was created to make this process 
easier and safer. It is a Shiny app that makes it easier to detect, 
specify, and save “harmonies” constructed between variables in donor 
surveys and variables in the ACS. The app launches in a browser window 
with the following call:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open "Survey Harmonization Tool" Shiny app</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">harmony</span>()</span></code></pre></div>
<p>At present, the <code>harmony()</code> app only allows specification 
of harmonies between a non-ACS donor survey and a specific ACS vintage 
(e.g.&nbsp;harmonizing 2015 RECS to 2015 ACS).</p>
<p>Construction of a harmony generally follows these steps:</p>
<ol style="list-style-type: decimal">
<li>Select a donor survey and vintage.</li>
<li>Select the recipient ACS vintage.</li>
<li>Select a “Donor variable” from the drop down list. The list is 
searchable to help locate variables associated with certain words.</li>
<li>Select a “ACS variable” to use for the “other side” of the harmony.</li>
<li>For <em>factor</em> variables, edit the “Group” columns in the 
spreadsheet objects to create the maximum-resolution harmony between the
 two variables. You can see the “live” outcome of the specified 
harmonization strategy in the table at the bottom of the page. For <em>continuous</em> variables, no additional modification is needed as long as the two variables measure similar concepts.</li>
<li>Once the harmony is specified as you like, click “Submit harmony”. 
The button only becomes available to click if minimal safety checks are 
passed for a valid harmony.</li>
</ol>
<p>When a user clicks “Submit harmony”, the currently-specified harmony 
(as defined by the selected variables and settings) is saved to disk. 
Specifically, the details of that particular harmony are added to the 
appropriate .R “harmony file” located at <code>/harmony/harmonies</code>. For example, the file describing how to harmonize RECS 2015 and ACS 2015 variables is <a href="https://github.com/ummel/fusionData/blob/master/harmony/harmonies/RECS_2015__ACS_2015.R">RECS_2015__ACS_2015.R</a>.</p>
<p>You should receive a pop-up message indicating if the harmony was 
successfully added to the local .R harmony file (it will be created, if 
necessary). You can confirm the harmony was added by selecting the “View
 harmonies” panel.</p>
<p>Probably the easiest way to become an expert with the app is to view 
existing harmonies that I’ve already constructed for the RECS and CEI. 
This will show you the settings used and give you a sense of how and why
 they were used.</p>
<hr>
<p>Additional details regarding “advanced” settings and examples. This 
may all seem convoluted at first. But once you understand what these 
fields are doing, it becomes quite easy, fast, and (almost) fun to 
construct harmonies.</p>
<p><em>Bin breakpoints</em></p>
<p>The Bin breakpoints field is used to specify how a continuous 
variable should be “binned” to turn it into a categorical variable – 
usually to allow for harmonization with a factor variable in the other 
survey. This is useful when an identical concept is measured on a 
continuous scale in one survey (e.g.&nbsp;income in dollars) and as a 
factor variable in the other survey (e.g.&nbsp;income range).</p>
<p>Example: Select “moneypy” for RECS 2015 to see how the ACS “hincp” is binned to create harmony.</p>
<p><em>Adjustment</em></p>
<p>The Adjustment field provides a powerful way to modify or adjust 
variables to accommodate non-standard harmonies. Text in the Adjustment 
field is passed as-is to a dplyr::mutate() call within <code>harmonize()</code>
 that modifies the associated variable prior to any other manipulation. 
The text passed to the mutate() call can utilize any other variables in 
the microdata. This is quite powerful and allows for complicated 
harmonies to be accommodated.</p>
<p>Example: Select “vehq” for CEI 2015-2019. In this case, the “vehq” 
(owned vehicles) and “vehql” (leased vehicles) variables in the CEI – 
both continuous – are added together by specifying “vehq + vehql” in the
 Adjustment field. The result is then binned to create harmony with the 
ACS “veh” variable, which is a factor variable referring to all 
available vehicles, whether owned or leased.</p>
<p><em>Household aggregator</em></p>
<p>Sometimes it is possible to create harmony between a household-level 
(“H”) donor variable and a person-level (“P”) ACS variable, provided 
that the latter is <em>aggregated</em> at the household level. In such cases, the “Household aggregator” field tells <code>harmonize()</code>
 how to aggregate or summarize the person-level ACS variable within each
 household. This field is only applicable when the donor variable is a 
household variable and the selected ACS variable is person-level 
(person-level donor variables can always be harmonized directly with 
person-level ACS variables).</p>
<p>Simple example: Select “hhage” for RECS 2015 
(Respondent/head-of-household age). The ACS “agep” variable can be used 
to create harmony, but it is a person-level variable. By setting the 
Household aggregator field to “reference” we instruct <code>harmonize()</code> to use the “reference person” value for “agep” to create a household-level variable analogous to “hhage”.</p>
<p>Advanced example: Select “numchild” for RECS 2015 (Number of 
household members age 17 or younger). The ACS “agep” variable can be 
used to create harmony. Bin breakpoints are used to re-assign each 
household member “agep” value to 1 if less than 18 and 0 if 18 or more 
(see the “Group” column in the associated spreadsheet). The Household 
aggregator field is the set to “sum” to instruct <code>harmonize()</code> to sum these values at the household level, which creates harmony with “numchild”.</p>
<p>Very advanced example: Select “as_comp1” for CEI 2015-2019 (Number of
 males age 16 and over). Again, the ACS “agep” variable can be used to 
create harmony (as above for “numchild”), but we need to additionally 
restrict the harmony to males only. This is done by using the Adjustment
 field to first set “agep” to 0 for all females, <em>then</em> bin the result, <em>then</em> sum at the household level.</p>
<p><em>Comments</em></p>
<p>The Comments field is used to leave helpful information about why the
 harmony was constructed as it was. Any harmony that makes use of one of
 the “advanced” settings should probably have a comment explaining the 
rationale.</p>
<hr>
<p>A harmony file can be <code>dget</code>-d to return a list of lists, 
where each element defines a harmony. Like this one, defining the 
harmony between the “fuelheat” variable in the RECS and the “hfl” 
variable in the ACS.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fuelheat__hfl <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">RECS =</span> <span class="fu">list</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">groups =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Do not use space heating"</span>, <span class="st">"Electricity"</span>, <span class="st">"Fuel oil/kerosene"</span>, <span class="st">"Natural gas from underground pipes"</span>, <span class="st">"Propane (bottled gas)"</span>, <span class="st">"Some other fuel"</span>, <span class="st">"Wood (cordwood or pellets)"</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="st">""</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">adj =</span> <span class="st">""</span>),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ACS =</span> <span class="fu">list</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">groups =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">4</span>, <span class="dv">7</span>),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Bottled, tank, or LP gas"</span>, <span class="st">"Coal or coke"</span>, <span class="st">"Electricity"</span>, <span class="st">"Fuel oil, kerosene, etc."</span>, <span class="st">"No fuel used"</span>, <span class="st">"Other fuel"</span>, <span class="st">"Solar energy"</span>, <span class="st">"Utility gas"</span>, <span class="st">"Wood"</span>),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="st">""</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">adj =</span> <span class="st">""</span>),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">comment =</span> <span class="st">""</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">modified =</span> <span class="st">"2021-07-03 12:10:17"</span>),</span></code></pre></div>
<p>This list object contains all of the information necessary to 
construct RECS and ACS microdata containing a new variable called 
"fuelheat__hfl“; i.e.&nbsp;the harmonized version of the two associated 
heating fuel variables. This is precisely what the <code>harmonize()</code> function does – typically when called by <code>prepare()</code>
 as explained below – using all of the harmonies available in the 
specified harmony file. Note that harmonized variables are always 
indicated by a double-underscore (”__").</p>
<p>Using the <code>harmony()</code> app to manually define harmonies and then letting <code>harmonize()</code> take care of subsequent data manipulation makes the construction of harmonized microdata easier, faster, and <em>much</em> safer. It is generally advisable to use the <code>harmonize()</code> app to create and edit harmonies. It is also possible to manually edit the .R harmony files, if necessary, but be careful.</p>
<p>Most users will eventually find themselves constructing harmonies via the app and, as a result, modifying their <em>local</em>
 version of .R harmony files. This means you must commit and push those 
changes for them to show up in the Github repository – and become 
available for others to use. This also means it is important to pull the
 most recent version of the repository when you begin working with 
fusionData. Otherwise, you risk duplicating the efforts of someone else 
and/or failing to make use of the most recent version of harmony (and 
other) files.</p>
<h2 id="compile-spatial-data">Compile spatial data</h2>
<p>fusionData allows for spatially-referenced data to be merged with 
survey microdata, thereby expanding the set of potential predictor 
variables available in the fusion process. The geographic “unit of 
analysis” in this case consists of <a href="https://www.census.gov/programs-surveys/geography/guidance/geo-areas/pumas.html">PUMA’s</a>, which are observed for ACS households and can be imputed for donor households.</p>
<p>Ingestion of spatial datasets is generally less onerous than for 
survey data; there are fewer requirements that the processed data must 
meet. The general strategy will look familiar: Raw spatial data is 
stored in <code>/geo-raw</code>. The raw data is transformed to a "*_processed.rds" file stored in <code>/geo-processed</code>. The associated .R file is stored in the same location.</p>
<p>A processed spatial .rds file has only two hard requirements it must meet.</p>
<ol style="list-style-type: decimal">
<li>It must contain a “vintage” column indicating the time period of 
each observation. The vintage can be a year, a year range (“2015-2016”),
 or the special value “always”. The “always” value indicates that a 
measurement is time-invariant (e.g.&nbsp;a long-term climate “normal”).</li>
<li>It must contain a column (or columns) whose name and values are also found in the <code>geo_concordance.fst</code> file. These columns define the location of the measurement and – via the <code>geo_concordance.fst</code> file – are mapped to PUMA’s.</li>
</ol>
<p>Ordered factor variables should be classed as such; other categorical variables can be character. It is <em>not</em> (currently) necessary to document the variables, name them a certain way, or create a dictionary. Let’s look at an example.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>irs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"geo-processed/IRS-SOI/IRS-SOI_2018_processed.rds"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(irs[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div>
<pre><code># A tibble: 6 × 5
  zcta10 vintage `Mean income per return` `Mean income per p… `Mean people per …
  &lt;chr&gt;    &lt;int&gt;                    &lt;int&gt;               &lt;int&gt;              &lt;dbl&gt;
1 35004     2018                    58600               28760               2.04
2 35005     2018                    41200               21200               1.94
3 35006     2018                    53100               25300               2.10
4 35007     2018                    62300               29240               2.13
5 35010     2018                    52900               25700               2.06
6 35014     2018                    50300               25900               1.94</code></pre>
<p>The <code>irs</code> object contains processed spatial data constructed from the <a href="https://www.irs.gov/statistics/soi-tax-stats-individual-income-tax-statistics-zip-code-data-soi">IRS Statistics of Income (SOI)</a> zip code tax return data for 2018. The underlying raw data is stored remotely at <code>/geo-raw/IRS-SOI/2018</code>. The script used to create the “processed.rds” file is <a href="https://github.com/ummel/fusionData/blob/master/geo-processed/IRS-SOI/IRS-SOI_AllVintages_processed.R">available here</a>. The “zcta10” column indicates the Zip Code Tabulation Area (circa 2010) associated with each observation.</p>
<p>The “zcta10” variable is also found in the “geo_concordance.fst” 
file, which contains information about how to link geographic units to 
PUMA’s. Its creation relies heavily on data from the Missouri Census 
Data Center’s <a href="https://mcdc.missouri.edu/applications/geocorr.html">Geocorr engine</a>.
 The information on how to link zip codes to PUMA’s is used to aggregate
 the IRS-SOI data to PUMA-level prior to merging with survey microdata.</p>
<p>The <code>geo_concordance.fst</code> file contains a variety of 
variables that can be used to identify the location of observations in a
 processed spatial data file. Most of these are <a href="https://mcdc.missouri.edu/applications/docs/maggot2014.html">documented by Geocorr</a>. Others were added within the <a href="https://github.com/ummel/fusionData/blob/master/geo-processed/concordance/geo_concordance.R"><code>geo-processed/concordance/geo_concordance.R</code></a>
 file to allow concordance with variables found in particular datasets. 
The concordance file can be expanded over time as necessary.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>concordance <span class="ot">&lt;-</span> fst<span class="sc">::</span><span class="fu">fst</span>(<span class="st">"geo-processed/concordance/geo_concordance.fst"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(concordance)</span></code></pre></div>
<pre><code> [1] "puma10"           "puma_weight"      "state"            "state_name"      
 [5] "state_postal"     "county10"         "cousubfp10"       "tract10"         
 [9] "bg10"             "zcta10"           "cbsa10"           "cbsatype10"      
[13] "metdiv10"         "csa10"            "sldu10"           "sldl10"          
[17] "sdbest10"         "sdbesttype10"     "sldu12"           "sldl12"          
[21] "ur12"             "ua12"             "cbsa13"           "cbsatype13"      
[25] "metdiv13"         "csa13"            "county14"         "cousubfp14"      
[29] "sldu14"           "sldl14"           "sdbest14"         "sdbesttype14"    
[33] "cbsa15"           "cbsatype15"       "metdiv15"         "csa15"           
[37] "sldu16"           "sldl16"           "cd111"            "cd113"           
[41] "cd114"            "cd115"            "cd116"            "region"          
[45] "division"         "recs_domain"      "recs_division"    "recs_ba_zone"    
[49] "recs_iecc_zone"   "climate_division"</code></pre>
<p>In some cases, the spatial dataset’s processed .rds file will include
 multiple location variables that are used collectively to achieve 
spatial concordance. For example, a spatial dataset with block group 
observations must include columns for “state”, “county10”, “tract10”, 
and “bg10” in order to allow a smooth merge with the concordance file 
(this is the case for the EPA-SLD dataset).</p>
<p>Unlike with processed <em>survey</em> data, the naming convention for processed spatial data files is quite relaxed. The function <code>compileSpatial()</code> automatically detects and compiles all files in <code>/geo-processed</code>
 ending with "_processed.rds". As long as a processed spatial data file 
has the necessary suffix – and meets the two hard requirements mentioned
 above – it will be compiled into the <code>geo_predictors.fst</code> file.</p>
<p>Whenever a processed .rds file is added or updated, it is necessary to run <code>compileSpatial()</code> to update the <code>geo_predictors.fst</code> file.</p>
<p>The <code>geo_predictors.fst</code> file contains all variables and 
vintages across available spatial datasets, aggregated to PUMA-level in 
preparation for merging with survey microdata. The structure of this 
file is unusual, but it is not intended to be worked with directly. It 
is designed to allow the <code>assemble()</code> function (demonstrated 
below) to efficiently read the necessary data from disk when it merges 
spatial variables for particular donor and recipient surveys.</p>
<p>Consequently, unless a user is actively adding or editing processed 
spatial data, the only “geo files” that are strictly necessary for the 
fusion process are <code>geo_predictors.fst</code> and <code>geo_concordance.fst</code>, both of which can be obtained by calling <code>getGeoProcessed(dataset = "essential")</code>.</p>
<h2 id="prepare-for-fusion">Prepare for fusion</h2>
<p>The following example shows how the fusionData <code>prepare()</code> and <code>assemble()</code> functions to generate complete, consistent, and harmonized microdata that can then be passed to the <a href="https://github.com/ummel/fusionModel">fusionModel package</a> to fuse donor variables to ACS microdata.</p>
<p>The simplest usage is shown below. In this case, we are requesting 
microdata outputs at the household-level that will allow us to 
(subsequently) fuse RECS 2015 donor variables to ACS 2015 recipient 
microdata. <code>prepare()</code> and <code>assemble()</code> are separate functions only because <code>prepare()</code> tends to be more expensive. It can usually be called just once (possibly saving the output to disk), while <code>assemble()</code> is then invoked multiple times to debug or test different assembly options.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare RECS 2015 household microdata for fusion with ACS 2015 microdata</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>prep <span class="ot">&lt;-</span> <span class="fu">prepare</span>(<span class="at">donor =</span> <span class="st">"RECS_2015"</span>, <span class="at">recipient =</span> <span class="st">"ACS_2015"</span>, <span class="at">respondent =</span> <span class="st">"household"</span>)</span></code></pre></div>
<pre><code>Harmonizing RECS_2015 (donor) microdata at household level
Harmonizing ACS_2015 (recipient) microdata at household level
Identified 124 geographic intersections in the donor...
Imputing PUMA for donor observations...
Assigning location variables to recipient observations...</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assemble using default options</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">assemble</span>(prep)</span></code></pre></div>
<pre><code>Identifying donor fusion variables...
Adding the following fusion variables:
 adqinsul, agecdryer, agecenac, agecwash, agedw, agefrzr, agerfri1, agerfri2, aircond, altfuelpev, amtmicro, appother, athome, attccool, attcheat, attic, atticfin, audit, auditchg, backup, basecool, basefin, baseheat, benother, blender, btuel, btuelahucol, btuelahuheat, btuelcdr, btuelcfan, btuelcok, btuelcol, btuelcw, btueldhum, btueldwh, btuelevapcol, btuelfrz, btuelhtbheat, btuelhtbpmp, btuelhum, btuellgt, btuelmicro, btuelnec, btuelplpmp, btuelrfg, btuelrfg1, btuelrfg2, btuelsph, btueltv1, btueltv2, btueltvrel, btuelwth, btufo, btufonec, btufosph, btufowth, btulp, btulpcdr, btulpcok, btulpnec, btulpsph, btulpwth, btung, btungcdr, btungcok, btunghtbheat, btungnec, btungplheat, btungsph, btungwth, cablesat, cdd30yr, cdd65, cdd80, cellar, cellphone, cenachp, coffee, coldma, combodvr, cooktuse, cooltype, crockpot, cufeetng, cufeetngcdr, cufeetngcok, cufeetnghtbheat, cufeetngnec, cufeetngplheat, cufeetngsph, cufeetngwth, cwasher, dbt1, dbt99, dishwash, dntheat, dolelahucol, dolelahuheat, dolelcdr, dolelcfan, dolelcok, dolelcol, dolelcw, doleldhum, doleldwh, dolelevapcol, dolelfrz, dolelhtbheat, dolelhtbpmp, dolelhum, dolellgt, dolelmicro, dolelnec, dolelplpmp, dolelrfg, dolelrfg1, dolelrfg2, dolelsph, doleltv1, doleltv2, doleltvrel, dolelwth, dolfonec, dolfosph, dolfowth, dollarel, dollarfo, dollarlp, dollarng, dollpcdr, dollpcok, dollpnec, dollpsph, dollpwth, dolngcdr, dolngcok, dolnghtbheat, dolngnec, dolngplheat, dolngsph, dolngwth, door1sum, drafty, dryer, dryrfuel, dryruse, dualcooktfuel, dualovenfuel, dvd, dwashuse, dwcycle, eelights, elcool, elfood, elother, elperiph, elwarm, elwater, energyasst, energyasst11, energyasst12, energyasst13, energyasst14, energyasst15, energyasstoth, equipage, equipaux, equipauxtype, equipm, equipmuse, escwash, esdishw, esdryer, esfreeze, esfrig, eslight, eswater, eswin, foodproc, foother, fopay, fowarm, fowater, freeaudit, fuelaux, fuelh2o, fuelh2o2, fuelpool, fueltub, gallonfo, gallonfonec, gallonfosph, gallonfowth, gallonlp, gallonlpcdr, gallonlpcok, gallonlpnec, gallonlpsph, gallonlpwth, gargcool, gargheat, gndhdd65, gwt, h2oheatapt, hdd30yr, hdd50, hdd65, heathome, highceil, hotma, ice, intdata, intdataacc, intstream, inwireless, kwh, kwhahucol, kwhahuheat, kwhcdr, kwhcfan, kwhcok, kwhcol, kwhcw, kwhdhum, kwhdwh, kwhevapcol, kwhfrz, kwhhtbheat, kwhhtbpmp, kwhhum, kwhlgt, kwhmicro, kwhnec, kwhplpmp, kwhrfg, kwhrfg1, kwhrfg2, kwhsph, kwhtv1, kwhtv2, kwhtvrel, kwhwth, lgtin4, lgtincan, lgtincfl, lgtincntl, lgtinled, lgtinnum, lgtoutcntl, lgtoutnum, locrfri2, lpcook, lpgpay, lpother, lpwarm, lpwater, micro, moisture, monpool, montub, morethan1h2o, ncombath, nhafbath, noacbroke, noacdays, noacel, noachelp, noheatbroke, noheatbulk, noheatdays, noheatel, noheathelp, noheatng, notmoist, numatticfan, numberac, numcfan, numfloorfan, numfreez, nummeal, numsmphone, numwholefan, oa_lat, othrooms, outgrill, outgrillfuel, outlet, oven, ovenfuel, ovenuse, payhelp, pelletamt, pelletbtu, periodel, periodfo, periodlp, periodng, playsta, pool, prkgplc1, protherm, prothermac, rebateapp, recbath, recycapp, ricecook, rooftype, scaleb, scalee, scaleg, sepcooktuse, sepdvr, sepovenuse, sizeofgarage, sizfreez, sizrfri1, sizrfri2, smartmeter, smarttherm, solar, solother, solwater, stories, stove, stovefuel, stovenfuel, studio, swampcol, swimpool, taxcreditapp, tempgone, tempgoneac, temphome, temphomeac, tempnite, tempniteac, thermain, thermainac, toast, toastovn, topfront, totalbtu, totalbtucdr, totalbtucok, totalbtuhtb, totalbtunec, totalbtupl, totalbtusph, totalbtuwth, totaldol, totaldolcdr, totaldolcok, totaldolhtb, totaldolnec, totaldolpl, totaldolsph, totaldolwth, totcsqft, tothsqft, totsqft_en, totucsqft, totusqft, tvaudiosys, tvcolor, tvonwd1, tvonwd2, tvonwe1, tvonwe2, tvsize1, tvsize2, tvtype1, tvtype2, typeglass, typerfr1, typerfr2, ugashere, ugcook, ugoth, ugwarm, ugwater, uprtfrzr, usecenac, useel, usefo, uselp, usemoisture, useng, usenotmoist, usesolar, usewood, usewwac, vcr, walltype, washload, wdother, wdpellet, wdwarm, wdwater, wheatage, wheatsiz, windows, winframe, woodamt, woodbtu, woodlogs, wsf, wwacage 
Merging donor spatial predictor variables...
Merging recipient spatial predictor variables...
Assembling output data frames...
Performing consistency checks...</code></pre>
<p>The resulting <code>data</code> object is a list containing two data 
frames. The first slot contains the “fusion ready” donor microdata. The 
second slot contains the analogous ACS recipient microdata. Notice that 
the RECS microdata has more variables/columns than the ACS data. This is
 because <code>assemble</code> donor output includes – by default – <em>all</em>
 valid variables in the donor survey not used to create harmonies. The 
latter are potential candidates for fusion (and there are many in the 
case of RECS).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data, dim)</span></code></pre></div>
<pre><code>$RECS_2015
[1] 5686  641

$ACS_2015
[1] 1226728     234</code></pre>
<p>A key purpose of <code>prepare()</code> is to harmonize the donor and recipient “shared” variables. This is done internally by the <code>harmonize()</code> function, using the variable harmonies created by users via the <code>harmony()</code> tool. In this case, <code>harmonize()</code> is using the <a href="https://github.com/ummel/fusionData/blob/master/harmony/harmonies/RECS_2015__ACS_2015.R">RECS_2015__ACS_2015.R</a> file to harmonize the donor and recipient microdata. Let’s look at a few of the shared variables after harmonization.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">names</span>(data<span class="sc">$</span>ACS_2015)[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">$</span>RECS_2015[v])</span></code></pre></div>
<pre><code>  weight bedrooms__bdsp desktop__laptop education__schl elpay__elefp
1  12090              3               2               2            2
2  14400              2               1               2            2
3  23330              4               2               1            2
4  12170              3               2               4            2
5  16720              3               2               2            2
6  26060              0               2               1            1</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data<span class="sc">$</span>ACS_2015[v])</span></code></pre></div>
<pre><code>  weight bedrooms__bdsp desktop__laptop education__schl elpay__elefp
1    110              5               2               4            2
2     91              4               2               5            2
3    112              4               2               2            2
4     80              3               2               3            2
5    156              3               2               3            2
6    100              1               2               4            2</code></pre>
<p>Notice that the harmonized variable <em>values</em> are typically integers (possibly factorized); that is, they contain no intelligible labels. This is because <code>harmonize()</code> maps each original value/level to a (integer) group assignment as specified in the relevant <code>.R</code> harmony file. The one exception is when <em>numeric</em>
 variables in the two surveys are conceptually identical and are then 
included “as is” or (automatically) converted to percentiles.</p>
<p>Since RECS and ACS are both nationally representative surveys, the 
distribution of the harmonized variables should look pretty similar 
across the two data frames. We can confirm this for the <code>fuelheat__hfl</code>
 variable, which creates harmony between the RECS and ACS heating fuel 
variables (“fuelheat” and “hfl”, respectively). We can compare the 
proportion of cases by harmonized value.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">table</span>(data<span class="sc">$</span>RECS_2015<span class="sc">$</span>fuelheat__hfl) <span class="sc">/</span> <span class="fu">nrow</span>(data[[<span class="dv">1</span>]]), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>    1     2     3     4     5     6     7 
0.045 0.347 0.043 0.491 0.042 0.001 0.030 </code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">table</span>(data<span class="sc">$</span>ACS_2015<span class="sc">$</span>fuelheat__hfl) <span class="sc">/</span> <span class="fu">nrow</span>(data[[<span class="dv">2</span>]]), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>    1     2     3     4     5     6     7 
0.012 0.364 0.055 0.469 0.064 0.008 0.028 </code></pre>
<p><code>prepare()</code> also calls the internal function <code>assignLocation()</code> to impute one or more plausible PUMA’s for each donor household. The <code>implicates</code> argument controls how many PUMA’s are imputed for each donor household. Setting <code>implicates</code>
 higher results in more variability in the spatial predictors merged to a
 given household, reflecting uncertainty about where the household is 
located. The use of implicates here mimics its usage in standard 
multiple imputation techniques (5 implicates is typical).</p>
<hr>
<p>The spatial imputation algorithm coded in <code>assignLocation()</code>
 requires some explanation. The location variables in the donor 
microdata are used to identify the set of possible PUMA’s assignable to 
each household, with the initial likelihood of selection being 
proportional to the number of housing units in the PUMA. However, we can
 also exploit the fact that we observe harmonized variables for donor 
and ACS respondents – and the PUMA of ACS respondents is known. That is,
 there is information in the <em>harmonized</em> variables that can be used to alter the likelihood of selecting a given PUMA.</p>
<p>A conceptual example: Imagine, based on location variables alone, we 
know that a particular donor household is resident in one of five PUMA’s
 (001 through 005), each with an equal number of housing units. Using 
this information alone, we would assign each PUMA an equal probability 
of selection (call it <em>P</em>). However, we also observe household 
income for both donor and ACS households. The donor household is high 
income. We notice in the ACS microdata that high income households are 
common in PUMA 001 but rare in the other four. Conceptually, this 
information should increase the probability of selecting PUMA 001.</p>
<p>In practice, we typically observe multiple harmonized variables – some categorical and some continuous. <code>assignLocation()</code> calculates <a href="https://www.jstor.org/stable/2528823">Gower’s distance</a>, using all of the harmonized variables, to derive a pairwise similarity value (<em>S</em>)
 between each donor household and a random sample of ACS households 
located within the feasible set of PUMA’s. The calculation uses the 
efficient <a href="https://cran.r-project.org/web/packages/gower/index.html">gower package</a>; even so, random sampling of the ACS is necessary to make it tractable. An ACS household (or multiple if <code>implicates</code> &gt; 1) is then randomly selected, where the probability of selection is <em>P</em> / <em>S</em> and the associated PUMA is imputed to the donor household. That is, the naive, population-based probability of selection (<em>P</em>) is modified by the observable similarity of the donor household and each ACS household (<em>S</em>).</p>
<hr>
<p><code>assemble()</code> also merges spatial variables onto both the donor and recipient microdata. Pre-compiled spatial variables (those in <code>geo_predictors.fst</code>)
 are merged onto both the donor and recipient microdata at the PUMA 
level, using imputed PUMA’s for the donor. Spatial variables are 
indicated by the double-dot (“..”) in the variable name, analogous to 
the way that harmonized variables are indicated by the double-underscore
 ("__").</p>
<p>Let’s look at the variables in the recipient ACS microdata.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data<span class="sc">$</span>ACS_2015)</span></code></pre></div>
<pre><code>  [1] "acs_2015_hid"            "weight"                 
  [3] "bedrooms__bdsp"          "desktop__laptop"        
  [5] "education__schl"         "elpay__elefp"           
  [7] "employhh__wkhp"          "fuelheat__hfl"          
  [9] "hhage__agep"             "hhsex__sex"             
 [11] "householder_race__rac1p" "internet__access"       
 [13] "kownrent__ten"           "moneypy__hincp"         
 [15] "ngpay__gasfp"            "nhsldmem__np"           
 [17] "numadult__agep"          "numchild__agep"         
 [19] "numfrig__refr"           "numtablet__handheld"    
 [21] "occupyyrange__mv"        "sdescent__hisp"         
 [23] "stoven__stov"            "totrooms__rmsp"         
 [25] "typehuq__bld"            "yearmaderange__ybl"     
 [27] "loc..ur12"               "loc..cbsatype15"        
 [29] "loc..region"             "loc..recs_division"     
 [31] "loc..recs_ba_zone"       "loc..recs_iecc_zone"    
 [33] "acs.pums..npa"           "acs.pums..accssywstsb"  
 [35] "acs.pums..accssywstsc"   "acs.pums..acrn"         
 [37] "acs.pums..acrhl"         "acs.pums..acrht"        
 [39] "acs.pums..anf1"          "acs.pums..agsn"         
 [41] "acs.pums..bthy"          "acs.pums..bdsp"         
 [43] "acs.pums..bldm"          "acs.pums..bldofhd"      
 [45] "acs.pums..bldofhm"       "acs.pums..bld5"         
 [47] "acs.pums..brdy"          "acs.pums..bsnf"         
 [49] "acs.pums..bsys"          "acs.pums..cmpy"         
 [51] "acs.pums..dlpy"          "acs.pums..dsly"         
 [53] "acs.pums..elep"          "acs.pums..fbry"         
 [55] "acs.pums..fsys"          "acs.pums..flpx"         
 [57] "acs.pums..gspy"          "acs.pums..hndy"         
 [59] "acs.pums..hflu"          "acs.pums..hfle"         
 [61] "acs.pums..hflf"          "acs.pums..insp"         
 [63] "acs.pums..lpty"          "acs.pums..mdmy"         
 [65] "acs.pums..mrgnb"         "acs.pums..mrgyp"        
 [67] "acs.pums..mrgp"          "acs.pums..mrgtn"        
 [69] "acs.pums..mrgty"         "acs.pums..mrgxn"        
 [71] "acs.pums..mrgm"          "acs.pums..mrgc"         
 [73] "acs.pums..othy"          "acs.pums..rfry"         
 [75] "acs.pums..rmsp"          "acs.pums..rntn"         
 [77] "acs.pums..rntp"          "acs.pums..rwty"         
 [79] "acs.pums..stly"          "acs.pums..snky"         
 [81] "acs.pums..stvy"          "acs.pums..tlysx"        
 [83] "acs.pums..tnow"          "acs.pums..tnof"         
 [85] "acs.pums..tnrn"          "acs.pums..tlysb"        
 [87] "acs.pums..vlpc"          "acs.pums..vhnv"         
 [89] "acs.pums..vh1v"          "acs.pums..vh2v"         
 [91] "acs.pums..vh3v"          "acs.pums..wtph"         
 [93] "acs.pums..yb19"          "acs.pums..y194"         
 [95] "acs.pums..y195"          "acs.pums..y196"         
 [97] "acs.pums..y197"          "acs.pums..y198"         
 [99] "acs.pums..y199"          "acs.pums..y202"         
[101] "acs.pums..fsnf"          "acs.pums..fsmcfhw"      
[103] "acs.pums..fsmcfhl"       "acs.pums..fsmcfn"       
[105] "acs.pums..fsof"          "acs.pums..fncp"         
[107] "acs.pums..fprn"          "acs.pums..fwr5"         
[109] "acs.pums..fw51"          "acs.pums..fw55"         
[111] "acs.pums..grnt"          "acs.pums..grpp"         
[113] "acs.pums..hhle"          "acs.pums..hhls"         
[115] "acs.pums..hhtm"          "acs.pums..hhto"         
[117] "acs.pums..hhtnhm"        "acs.pums..hhtnhf"       
[119] "acs.pums..hncp"          "acs.pums..hgch"         
[121] "acs.pums..hwc6"          "acs.pums..hw61"         
[123] "acs.pums..hw66"          "acs.pums..hpc6"         
[125] "acs.pums..hpc61"         "acs.pums..hpc661"       
[127] "acs.pums..hpr6"          "acs.pums..hpr61"        
[129] "acs.pums..hpr661"        "acs.pums..ktyh"         
[131] "acs.pums..lal1"          "acs.pums..mltn"         
[133] "acs.pums..mv1m"          "acs.pums..m1t2"         
[135] "acs.pums..m2t4"          "acs.pums..m5t9"         
[137] "acs.pums..m1t1"          "acs.pums..m2t2"         
[139] "acs.pums..nocc"          "acs.pums..npfd"         
[141] "acs.pums..nppn"          "acs.pums..nrnn"         
[143] "acs.pums..nrcg"          "acs.pums..ocpp"         
[145] "acs.pums..prtn"          "acs.pums..plmy"         
[147] "acs.pums..psfn"          "acs.pums..r18n"         
[149] "acs.pums..r60n"          "acs.pums..r601"         
[151] "acs.pums..r65n"          "acs.pums..r651"         
[153] "acs.pums..rsmm"          "acs.pums..rsmc"         
[155] "acs.pums..smcp"          "acs.pums..smxnbb"       
[157] "acs.pums..smxnob"        "acs.pums..ssmh"         
[159] "acs.pums..txpn"          "acs.pums..wfnn"         
[161] "acs.pums..wfnw"          "acs.pums..wf1w"         
[163] "acs.pums..wf2w"          "acs.pums..wkxn"         
[165] "acs.pums..wkxrlhs"       "acs.pums..wkxrlhwftsw"  
[167] "acs.pums..wkxrlhwftsd"   "acs.pums..wkxrlhd"      
[169] "acs.pums..wkxf"          "acs.pums..wrksttnf"     
[171] "acs.pums..wrkstthw"      "acs.pums..wrkstthl"     
[173] "acs.pums..wrksttnh"      "acs.pums..wrkf"         
[175] "acs.pums..elfv"          "acs.pums..flfi"         
[177] "acs.pums..flfn"          "acs.pums..gsfpip"       
[179] "acs.pums..gsfpir"        "acs.pums..gsfn"         
[181] "acs.pums..wtfi"          "acs.pums..wtfn"         
[183] "acs.sf..b010"            "acs.sf..b060"           
[185] "acs.sf..b080"            "acs.sf..b1900"          
[187] "acs.sf..b1910"           "acs.sf..b1920"          
[189] "acs.sf..b25010"          "acs.sf..b250350"        
[191] "acs.sf..b250390"         "acs.sf..b25060"         
[193] "acs.sf..b250710"         "acs.sf..b250770"        
[195] "acs.sf..b25080"          "acs.sf..b25090"         
[197] "acs.sf..b2510"           "climate..cddb6"         
[199] "climate..hddb6"          "climate..cdd12b6"       
[201] "climate..hdd12b6"        "climate..iccz"          
[203] "climate..bznf"           "eia.seds..gslp"         
[205] "eia.seds..elcp"          "eia.seds..ntgp"         
[207] "eia.seds..lpgp"          "eia.seds..fllp"         
[209] "eia.seds..elmh"          "eia.seds..ntth"         
[211] "eia.seds..lpgh"          "eia.seds..flgh"         
[213] "irs.soi..mipr"           "irs.soi..mipp"          
[215] "irs.soi..mppr"           "irs.soi..mdpr"          
[217] "irs.soi..prsr"           "irs.soi..prjr"          
[219] "irs.soi..phohr"          "irs.soi..pppr"          
[221] "irs.soi..pvpr"           "irs.soi..prcntelr"      
[223] "irs.soi..prfr"           "irs.soi..prcntetr"      
[225] "irs.soi..prie"           "irs.soi..priu"          
[227] "irs.soi..eftr"           "irs.soi..palt2"         
[229] "irs.soi..pa2t5"          "irs.soi..pa5t7"         
[231] "irs.soi..pa7t1"          "irs.soi..pa1t2"         
[233] "irs.soi..pa2om"          "nrel.urdb..rsed"        </code></pre>
<p>The string to the left of the “..” identifies the spatial dataset 
that the variable comes from (e.g.&nbsp;“irs.soi”). The string to the 
right is a unique, syntactically-valid identifier. It’s not critical 
that specific spatial variables be identifiable in the fusion process. 
And because pre-processing of spatial datasets does not impose a 
stringent naming/documentation convention (it is flexible by design), 
these non-nonsensical-but-unique names are the safest way to identify 
spatial variables.</p>
<p>The "loc..*" variables refer to the location variables directly 
observed in the donor and assignable to recipient microdata on the basis
 of respondent PUMA.</p>
<p>Now let’s explore some of the additional arguments to <code>assemble()</code>:</p>
<ol style="list-style-type: decimal">
<li><p>We can request certain fusion variables by passing a character vector to <code>fusion.variables</code>.
 The input is checked internally against the data and only valuid fusion
 candidates are returned (with helpful message to console).</p></li>
<li><p>We can limit the spatial datasets merged to the microdata via the <code>spatial.datasets</code> argument. Default is to include all available datasets, and this is sensible in most cases.</p></li>
<li><p>The <code>window</code> argument controls how wide a timespan (+/- <code>window</code> years from the data vintage) is tolerated when merging spatial variables to microdata. The default (<code>window = 0</code>) means that spatial variables are merged only when their vintage matches that of the microdata. A larger <code>window</code> will generally mean more spatial variables in the output but at some cost in terms of temporal alignment.</p></li>
<li><p>The <code>pca</code> argument controls whether/how principal components analysis (PCA) is used to reduce dimensionality of the spatial variables. <code>?prepare</code> provides additional details concerning the <code>pca</code> argument.</p></li>
<li><p>Setting <code>replicates = TRUE</code> will cause replicate observation weights to be returned along with the central/primary <code>weight</code> column.</p></li>
</ol>
<p>The following shows a more complex (and realistic) call to <code>prepare()</code> and <code>assemble()</code>, making use of the optional arguments.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare RECS 2015 household microdata for fusion with ACS 2015 microdata</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>prep <span class="ot">&lt;-</span> <span class="fu">prepare</span>(<span class="at">donor =</span> <span class="st">"RECS_2015"</span>, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">recipient =</span> <span class="st">"ACS_2015"</span>, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">respondent =</span> <span class="st">"household"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">implicates =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code>Harmonizing RECS_2015 (donor) microdata at household level
Harmonizing ACS_2015 (recipient) microdata at household level
Identified 124 geographic intersections in the donor...
Imputing PUMA for donor observations...
Assigning location variables to recipient observations...</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">assemble</span>(prep,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fusion.variables =</span> <span class="fu">c</span>(<span class="st">"cooltype"</span>, <span class="st">"agecenac"</span>, <span class="st">"kwhcol"</span>),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">window =</span> <span class="dv">3</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">pca =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="fl">0.9</span>))</span></code></pre></div>
<pre><code>Identifying donor fusion variables...
Adding the following fusion variables:
 agecenac, cooltype, kwhcol 
Performing principal components analysis...
Merging donor spatial predictor variables...
Merging recipient spatial predictor variables...
Assembling output data frames...
Performing consistency checks...</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(data, dim)</span></code></pre></div>
<pre><code>$RECS_2015
[1] 26213    67

$ACS_2015
[1] 1226728      64</code></pre>
<p>The number of observations in the donor microdata is now higher, reflecting the use of <code>implicates = 5</code>. Note that the number of rows has actually increased by less than a factor of five. This is because <code>assignLocation()</code>
 collapses duplicate household-PUMA observations and adjusts the sample 
“weight” column accordingly. This reduces the amount of data without 
affecting subsequent statistical results.</p>
<p>The difference in the number of columns between the RECS and ACS 
microdata is due to the former’s inclusion of our three requested fusion
 variables. Otherwise, both data frames are entirely consistent with one
 another; <code>assemble()</code> performs formal checks to ensure this 
is the case. Each microdata set includes a unique household identifier 
variable and an identical set of harmonized survey and spatial variables
 that can be exploited by the fusion process.</p>
<p>By specifying the <code>pca</code> argument, the <em>numeric</em> 
spatial variables are collapsed into a smaller number of components – 
indicated by the “pca..” prefix – which we can confirm by looking at the
 recipient column names.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data<span class="sc">$</span>ACS_2015)</span></code></pre></div>
<pre><code> [1] "acs_2015_hid"            "weight"                 
 [3] "bedrooms__bdsp"          "desktop__laptop"        
 [5] "education__schl"         "elpay__elefp"           
 [7] "employhh__wkhp"          "fuelheat__hfl"          
 [9] "hhage__agep"             "hhsex__sex"             
[11] "householder_race__rac1p" "internet__access"       
[13] "kownrent__ten"           "moneypy__hincp"         
[15] "ngpay__gasfp"            "nhsldmem__np"           
[17] "numadult__agep"          "numchild__agep"         
[19] "numfrig__refr"           "numtablet__handheld"    
[21] "occupyyrange__mv"        "sdescent__hisp"         
[23] "stoven__stov"            "totrooms__rmsp"         
[25] "typehuq__bld"            "yearmaderange__ybl"     
[27] "loc..ur12"               "loc..cbsatype15"        
[29] "loc..region"             "loc..recs_division"     
[31] "loc..recs_ba_zone"       "loc..recs_iecc_zone"    
[33] "climate..iccz"           "climate..bznf"          
[35] "pca..PC1"                "pca..PC2"               
[37] "pca..PC3"                "pca..PC4"               
[39] "pca..PC5"                "pca..PC6"               
[41] "pca..PC7"                "pca..PC8"               
[43] "pca..PC9"                "pca..PC10"              
[45] "pca..PC11"               "pca..PC12"              
[47] "pca..PC13"               "pca..PC14"              
[49] "pca..PC15"               "pca..PC16"              
[51] "pca..PC17"               "pca..PC18"              
[53] "pca..PC19"               "pca..PC20"              
[55] "pca..PC21"               "pca..PC22"              
[57] "pca..PC23"               "pca..PC24"              
[59] "pca..PC25"               "pca..PC26"              
[61] "pca..PC27"               "pca..PC28"              
[63] "pca..PC29"               "pca..PC30"              </code></pre>
<h2 id="make-it-rain">Make it rain</h2>
<p>At this point, we are ready to fuse. This is straightforward using the <code>train()</code> and <code>fuse()</code> functions from the fusionModel package. To make this even easier, <code>assemble()</code> donor output includes a “fusion.vars” attribute that can be passed directly to <code>train()</code> to identify the variables available to be fused.</p>
<pre><code>library(fusionModel)</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">train</span>(<span class="at">data =</span> data<span class="sc">$</span>RECS_2015, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">attr</span>(data, <span class="st">"fusion.vars"</span>), </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">ignore =</span> <span class="st">"recs_2015_hid"</span>, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">weight =</span> <span class="st">"weight"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">cores =</span> <span class="dv">2</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">maxcats =</span> <span class="dv">10</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">complexity =</span> <span class="fl">0.01</span>)</span></code></pre></div>
<pre><code>3 fusion variables
62 initial predictor variables
26213 observations
Searching for derivative relationships...
Determining order of fusion variables...
Building fusion models...</code></pre>
<p>We then <code>fuse()</code> (i.e.&nbsp;simulate) the fusion variables
 onto the harmonized ACS microdata. This is a non-trivial exercise, 
since the recipient ACS microdata has 1226728 observations. Ensuring <code>induce = FALSE</code>
 (the default) eases the computation and memory burden considerably. The
 call below shouldn’t require more than about 5GB of RAM.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">fuse</span>(<span class="at">data =</span> data<span class="sc">$</span>ACS_2015, <span class="at">train.object =</span> fit)</span></code></pre></div>
<p>A quick check that the fusion output looks plausible:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(sim)</span></code></pre></div>
<pre><code>[1] 1226728</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim)</span></code></pre></div>
<pre><code>     kwhcol                   agecenac                                 cooltype
1  576.3857 No central air conditioner Individual window/wall or portable units
2 2367.5607         10 to 14 years old          Central air conditioning system
3 3459.5585      Less than 2 years old          Central air conditioning system
4 4432.3754         10 to 14 years old          Central air conditioning system
5    0.0000 No central air conditioner                      No air conditioning
6 2298.4798           5 to 9 years old          Central air conditioning system</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>RECS_2015<span class="sc">$</span>kwhcol)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0     390    1113    1875    2533   20350 </code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sim<span class="sc">$</span>kwhcol)</span></code></pre></div>
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   371.1  1071.4  1836.8  2513.6 20350.0 </code></pre>
<p>Onward and upward!</p>



</body></html>