<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Pre-process raw survey and spatial data. Harmonize variables across surveys. Build harmonized microdata for use in fusionModel package.">
<title>Data backend for fusionACS platform • fusionData</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Data backend for fusionACS platform">
<meta property="og:description" content="Pre-process raw survey and spatial data. Harmonize variables across surveys. Build harmonized microdata for use in fusionModel package.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">fusionData</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="fusiondata">fusionData<a class="anchor" aria-label="anchor" href="#fusiondata"></a>
</h1></div>
<p>Kevin Ummel (<a href="mailto:ummel@berkeley.edu" class="email">ummel@berkeley.edu</a>)</p>
<ul>
<li><a href="#overview" id="toc-overview">Overview</a></li>
<li><a href="#setup-and-install" id="toc-setup-and-install">Setup and install</a></li>
<li><a href="#usage-and-structure" id="toc-usage-and-structure">Usage and structure</a></li>
<li><a href="#ingest-survey-data" id="toc-ingest-survey-data">Ingest survey data</a></li>
<li><a href="#document-variables" id="toc-document-variables">Document variables</a></li>
<li><a href="#harmonize-variables" id="toc-harmonize-variables">Harmonize variables</a></li>
<li><a href="#compile-spatial-data" id="toc-compile-spatial-data">Compile spatial data</a></li>
<li><a href="#prepare-fusion-inputs" id="toc-prepare-fusion-inputs">Prepare fusion inputs</a></li>
<li><a href="#generate-fusion-outputs" id="toc-generate-fusion-outputs">Generate fusion outputs</a></li>
</ul>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><strong>fusionData</strong> is used to create and manage the data inputs underpinning the larger fusionACS platform. It facilitates a number of steps in the overall fusionACS workflow:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Ingest</strong>: Process raw survey data using a standard approach and formatting.</li>
<li>
<strong>Document</strong>: Document survey variables and compile a “universal” data dictionary.</li>
<li>
<strong>Harmonize</strong>: Harmonize variables in “donor” surveys with those in the American Community Survey (ACS).</li>
<li>
<strong>Compile spatial data</strong>: Compile data from multiple spatial datasets for merging with survey microdata.</li>
<li>
<strong>Prepare fusion inputs</strong>: Prepare harmonized donor and ACS microdata fusion inputs.</li>
<li>
<strong>Generate fusion outputs</strong>: Fuse donor variables to ACS microdata using <a href="https://github.com/ummel/fusionModel" class="external-link">fusionModel</a>.</li>
</ol>
</div>
<div class="section level2">
<h2 id="setup-and-install">Setup and install<a class="anchor" aria-label="anchor" href="#setup-and-install"></a>
</h2>
<p>The fusionData <em>master</em> branch can be cloned to its own project directory on your local machine using RStudio and <a href="https://book.cds101.com/using-rstudio-server-to-clone-a-github-repo-as-a-new-project.html" class="external-link">these instructions</a>.</p>
<p>Use the following setup parameters:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Repository URL<span class="sc">:</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ummel<span class="sc">/</span>fusionData</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>Project directory name<span class="sc">:</span> fusionData</span></code></pre></div>
<p>You will be prompted to enter your Github username and password. You may be prompted to install some package dependencies. If you use multi-factor authentication for your Github credentials, you will need to enable an SSH key, and will need to use <code>git@github.com:ummel/fusionData.git</code> as the Repository URL in the above setup parameters.</p>
<p>Although fusionData is structured (and loadable) as a <em>R</em> package, it also acts as a code and data <em>repository</em> that is shared and continuously modified by authorized users. fusionData grows over time as new surveys and spatial datasets – and the code needed to process and manipulate them – are added.</p>
<p>Now that the shared Github repository has been cloned to your local drive (in a <code>/fusionData</code> project directory), we can install the package locally and load it. This step will install any required package dependencies and may take awhile. You will be redirected to a browser window to enter credentials for the Google Drive account storing fusionData’s remote files. The password is provided separately for approved users.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Do initial local install of the fusionData package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install</a></span><span class="op">(</span>quick <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the fusionData package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ummel.github.io/fusionData/">fusionData</a></span><span class="op">)</span></span></code></pre></div>
<p>Whenever the fusionData package is loaded, it checks that the current working directory is set to your local <code>/fusionData</code> directory (it will issue an error otherwise). This is because the package works with (and expects) a particular directory structure locally that is mimicked in the Github repository.</p>
<p>fusionData includes a convenience function called <code><a href="reference/installPackage.html">installPackage()</a></code> to safely update (re-install) your local installation of the fusionData package. If you modify important code yourself or pull changes from the Github repository, it is necessary to re-install the fusionData <em>package</em> locally to get all of the functionality. For example, if a function is added or modified on Github, your local installation won’t reflect the changes until you pull and re-install. <code><a href="reference/installPackage.html">installPackage()</a></code> does a number of operations that our initial <code><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">devtools::install()</a></code> didn’t, so let’s go ahead and run it now:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/installPackage.html">installPackage</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For full functionality, it is also necessary to download at least some of the remotely-stored survey microdata and processed spatial data files. The following section (“Usage and structure”) provides more detail about this and the associated reasoning. The functions <code><a href="reference/getSurveyProcessed.html">getSurveyProcessed()</a></code> and <code><a href="reference/getGeoProcessed.html">getGeoProcessed()</a></code> offer an easy way to do this. For example, to run most of the code in this README you will minimally need:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download RECS 2015 processed survey microdata file</span></span>
<span><span class="fu"><a href="reference/getSurveyProcessed.html">getSurveyProcessed</a></span><span class="op">(</span>survey <span class="op">=</span> <span class="st">"RECS_2015"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download only the essential remote spatial data files</span></span>
<span><span class="fu"><a href="reference/getGeoProcessed.html">getGeoProcessed</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"essential"</span><span class="op">)</span></span></code></pre></div>
<p>The downloads may take a few minutes. The files are automatically placed in the appropriate sub-directories of <code>/fusionData</code> on your local drive, with the directories created if necessary. After successful download, your fusionData “system” is ready to go.</p>
</div>
<div class="section level2">
<h2 id="usage-and-structure">Usage and structure<a class="anchor" aria-label="anchor" href="#usage-and-structure"></a>
</h2>
<p>As you modify code and files in your local <code>/fusionData</code> project directory, you will need to commit and <em>push</em> those changes to the Github repository for them to be accessible to other users. In addition, it is good practice to <em>pull</em> the latest version of the repository from Github prior to making any modifications. That way, you know you are working from the latest shared version. This is most easily done using the “Git” panel in the RStudio IDE.</p>
<p>Since Github places limits on file/repository size, we store certain data files “remotely” – that is, outside of the Github repository. The remotely-stored data files are integral to the overall fusionData “system”, but they are not present in the Github repository itself. Instead, the remote files (and associated directory structure) are stored in Google Drive and can be automatically and safely added to a user’s <em>local</em> <code>/fusionData</code> folder using provided functions. Once the remote files are added, the user’s local fusionData package is fully functional. Remote data files are fairly static. So, a user typically only needs to update (re-download) remote files to their local fusionData directory if important changes have been made.</p>
<p>You don’t generally need to keep track of which files are stored remotely and which are in the Github repository (the <a href="https://github.com/ummel/fusionData/blob/master/.gitignore" class="external-link">.gitignore</a> file handles this).</p>
<p><strong>In summary: The Github repository stores the code needed to build and document the fusionData architecture. Large and/or infrequently-modified data files are stored remotely. Users can download/upload remote files to/from their local <code>/fusionData</code> directory as-needed. When users add or modify <em>code</em>, the changes are committed locally and then pushed to the Github repository where they become subject to code reviews, versioning control, and accessible to other users.</strong></p>
<p>Below is an overview of the top-level directories in the fusionData repository, including both Github-based and “remote” elements.</p>
<div class="section level3">
<h3 id="github">
<code>/.github</code><a class="anchor" aria-label="anchor" href="#github"></a>
</h3>
<p>Auto-generated files for producing fusionData’s <a href="https://ummel.github.io/fusionData/">public documentation website</a>. <em>Most users do not need to access/modify this directory.</em></p>
</div>
<div class="section level3">
<h3 id="r">
<code>/R</code><a class="anchor" aria-label="anchor" href="#r"></a>
</h3>
<p><code>.R</code> scripts defining functions for doing “fusionData things” (not all are exported). <em>Most users do not need to access/modify this directory.</em></p>
</div>
<div class="section level3">
<h3 id="man">
<code>/man</code><a class="anchor" aria-label="anchor" href="#man"></a>
</h3>
<p>Documentation (i.e. “manual”) of functions in <code>/R</code> and data in <code>/data</code>, as usual for R packages. <em>Most users do not need to access/modify this directory.</em></p>
</div>
<div class="section level3">
<h3 id="data">
<code>/data</code><a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>Package-wide <code>.rda</code> data files. Loadable via <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code>, as usual for R packages. <em>Most users do not need to access/modify this directory.</em></p>
</div>
<div class="section level3">
<h3 id="data-raw">
<code>/data-raw</code><a class="anchor" aria-label="anchor" href="#data-raw"></a>
</h3>
<p><code>.R</code> scripts needed to create any package-wide <code>.rda</code> objects in <code>/data</code>, as usual for R packages. <em>Most users do not need to access/modify this directory.</em></p>
</div>
<div class="section level3">
<h3 id="universe">
<code>/universe</code><a class="anchor" aria-label="anchor" href="#universe"></a>
</h3>
<p>Directory for the “Universal Survey Dictionary” Shiny app. The app itself can be run by calling <code><a href="reference/universe.html">universe()</a></code>. <em>Most users do not need to access/modify this directory.</em></p>
</div>
<div class="section level3">
<h3 id="harmony">
<code>/harmony</code><a class="anchor" aria-label="anchor" href="#harmony"></a>
</h3>
<p>Directory for the “Survey Harmonization Tool” Shiny app. The app itself can be run by calling <code><a href="reference/harmony.html">harmony()</a></code>. <em>Most users do not need to access/modify this directory.</em></p>
</div>
<div class="section level3">
<h3 id="survey-processed">
<code>/survey-processed</code><a class="anchor" aria-label="anchor" href="#survey-processed"></a>
</h3>
<p>Contains processed survey data and associated code. Sub-directories refer to specific surveys and vintages. <em>Users responsible for ingesting raw survey microdata will add their custom processing code to this directory.</em></p>
<p>Example: <code>/survey-processed/RECS/2015</code></p>
<p>The Github repository version of <code>/survey-processed</code> contains two kinds of files:</p>
<ol style="list-style-type: decimal">
<li>Custom .R scripts that transform <em>raw</em> survey microdata (located in <code>/survey-raw</code>) into “processed” versions that adhere to certain requirements, structure, and naming conventions.</li>
</ol>
<p>Example: <code>/survey-processed/RECS/2015/RECS_2015_H_processed.R</code></p>
<ol start="2" style="list-style-type: decimal">
<li>“Dictionary” files (.rds) that contain standardized metadata and variable descriptions for a particular survey.</li>
</ol>
<p>Example: <code>/survey-processed/RECS/2015/RECS_2015_H_dictionary.rds</code></p>
<p><code>/survey-processed</code> also includes .fst files containing the processed microdata itself. These files are stored remotely and can be added to a user’s local fusionData directory by calling <code><a href="reference/getSurveyProcessed.html">getSurveyProcessed()</a></code>.</p>
<p>For example, the .fst file <code>/survey-processed/RECS/2015/RECS_2015_H_processed.fst</code> contains processed, household-level microdata for the 2015 RECS. The <em>code</em> that creates this file is found in <code>/survey-processed/RECS/2015/RECS_2015_H_processed.R</code>. The .R file is part of the Github repository (<a href="https://github.com/ummel/fusionData/blob/master/survey-processed/RECS/2015/RECS_2015_H_processed.R" class="external-link">see here</a>), but the .fst file is stored remotely.</p>
<p>Use of <a href="http://www.fstpackage.org/" class="external-link">.fst files</a> allows data to be read very quickly from disk, in part or in full. Functions in the fusionData package take advantage of this.</p>
</div>
<div class="section level3">
<h3 id="survey-raw">
<code>/survey-raw</code><a class="anchor" aria-label="anchor" href="#survey-raw"></a>
</h3>
<p>A remote directory (i.e. not present in the Github repository) containing <em>raw</em> survey data files. Sub-directories refer to specific surveys and vintages. <em>Users responsible for ingesting raw survey microdata will add the raw data files to this directory.</em></p>
<p>Example: <code>/survey-raw/RECS/2015</code></p>
<p><code>/survey-raw</code> can be downloaded and added to a user’s local fusionData directory by calling <code>getSurveyRaw()</code>. However, in practice, there is no reason for a user to store raw survey data locally unless it is for a survey that they are actively processing or editing. Once the <em>processed</em> version of a survey (<code>*_processed.fst</code>) is stable and uploaded to the remote Google Drive, users can access and use the processed version without ever needing to download or look at the original/raw data.</p>
</div>
<div class="section level3">
<h3 id="geo-processed">
<code>/geo-processed</code><a class="anchor" aria-label="anchor" href="#geo-processed"></a>
</h3>
<p>Contains processed spatial data and associated code. Sub-directories refer to specific spatial datasets. <em>Most users do not need to access/modify this directory.</em> For users who are not modifying or adding spatial datasets, it is sufficient to call <code>getGeoProcessed(dataset = "essential")</code> to load the essential “geo” files.</p>
<p>Example: <code>/geo-processed/EPA-SLD</code></p>
<p>The Github repository version of <code>/geo-processed</code> contains the following kinds of files:</p>
<ol style="list-style-type: decimal">
<li>Custom <code>.R</code> scripts that transform <em>raw</em> spatial data (located in <code>/geo-raw</code>) into processed .rds files that meet certain requirements.</li>
</ol>
<p>Example: <code>/geo-processed/EPA-SLD/epa-sld_v3_processed.R</code></p>
<p><code>/geo-processed</code> also includes .rds files containing the processed spatial data itself. These files are stored remotely and can be added to a user’s local fusionData directory by calling <code><a href="reference/getGeoProcessed.html">getGeoProcessed()</a></code>.</p>
<p>For example, the .rds file <code>/geo-processed/EPA-SLD/epa-sld_v3_processed.rds</code> contains processed spatial variables from version 3 of the EPA’s <a href="https://www.epa.gov/smartgrowth/smart-location-mapping#SLD" class="external-link">Smart Location Database (SLD)</a>. The <em>code</em> that creates this file is found in <code>/geo-processed/EPA-SLD/epa-sld_v3_processed.R</code>. The .R file is part of the Github repository (<a href="https://github.com/ummel/fusionData/blob/master/geo-processed/EPA-SLD/epa-sld_v3_processed.R" class="external-link">see here</a>), but the .rds file is stored remotely.</p>
<p>Importantly, the <code>/geo-processed</code> remote content <em>also</em> includes two “essential” spatial data files that are, in practice, all that most users will need to perform data fusion locally. These files and their roles are described in more detail later on.</p>
<ol style="list-style-type: decimal">
<li><code>geo_predictors.fst</code></li>
<li><code>concordance/geo_concordance.fst</code></li>
</ol>
</div>
<div class="section level3">
<h3 id="geo-raw">
<code>/geo-raw</code><a class="anchor" aria-label="anchor" href="#geo-raw"></a>
</h3>
<p>A remote directory (i.e. not present in the Github repository) containing <em>raw</em> spatial data files. Sub-directories refer to specific spatial datasets. <em>Most users do not need to access/modify this directory.</em></p>
<p>Example: <code>/geo-raw/EPA-SLD</code></p>
<p><code>/geo-raw</code> can be downloaded and added to a user’s local fusionData directory by calling <code>getGeoRaw()</code>. However, in practice, there is no reason for a user to store raw spatial data locally unless it is for a spatial dataset that they are actively processing or editing.</p>
</div>
<div class="section level3">
<h3 id="fusion">
<code>/fusion</code><a class="anchor" aria-label="anchor" href="#fusion"></a>
</h3>
<p>Contains production-level fusion input and output files generated by <code><a href="reference/fusionInput.html">fusionInput()</a></code> and <code><a href="reference/fusionOutput.html">fusionOutput()</a></code>. Users will call these functions to perform fusion but typically don’t need to access/modify the directory itself. Almost all fusion input/output files are stored remotely given their size. The only files that are pushed to the Github repository are .txt log files that contain information about the <code><a href="reference/fusionInput.html">fusionInput()</a></code> and <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> function calls.</p>
</div>
<div class="section level3">
<h3 id="production">
<code>/production</code><a class="anchor" aria-label="anchor" href="#production"></a>
</h3>
<p>A now-DEPRECATED directory containing code and possibly data from older “production” fusion runs. Superseded by <code>/fusion</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="ingest-survey-data">Ingest survey data<a class="anchor" aria-label="anchor" href="#ingest-survey-data"></a>
</h2>
<p>“Ingesting” a survey requires transforming raw survey data into “processed” (i.e. standardized) microdata files that meet certain requirements. The fusionData codebase depends on the processed microdata having recognizable structure and features.</p>
<p>The ingestion process for each survey is documented and defined by a .R script (possibly multiple scripts) that must be written manually. The goal is to produce a data.frame containing microdata observations that (ideally) meet the following conditions:</p>
<ul>
<li>Contains as many observations and variables as possible.</li>
<li>Variable names and descriptions are taken from the official codebook, possibly modified for clarity.</li>
<li>Official variable names are coerced to lower-case alphanumeric, possibly using single underscores.</li>
<li>Codes used in the raw data are replaced with descriptive labels from the codebook; e.g. integer values are replaced with associated factor levels.</li>
<li>All “valid blanks” in the raw data are set to plausible values; NA’s are often actual zeros or some other knowable value based on the question structure.</li>
<li>All “invalid blanks” or missing values in the raw data are imputed; a generic imputation function is provided for this purpose.</li>
<li>Ordered factors are used and defined whenever possible (as opposed to unordered).</li>
<li>Standard column names are used for unique household identifiers (e.g. “acs_2019_hid”); for person-level microdata the within-household person identifier (integer) is always “pid”.</li>
<li>Standard column names are used for observation weights; “weight” for the primary weighting variable and “rep_1”, etc. for replicate weights.</li>
<li>Variables identifying respondent location are consistent with those defined in <code>geo-processed/concordance/geo_concordance.fst</code>.</li>
</ul>
<p>Let’s look at a few of the variables in the processed RECS 2015 microdata to get a sense of what preferred output looks like. Note that the file name includes a <code>_H_</code> identifier, indicating that the microdata in question is household-level. Surveys that include both household and person-level respondent information have two such files – both “H” and “P” microdata. The RECS has only household (“H”) microdata.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recs</span> <span class="op">&lt;-</span> <span class="fu">fst</span><span class="fu">::</span><span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="st">"survey-processed/RECS/2015/RECS_2015_H_processed.fst"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">recs</span>, <span class="va">recs_2015_hid</span>, <span class="va">weight</span>, <span class="va">rep_1</span>, <span class="va">sizeofgarage</span>, <span class="va">recs_iecc_zone</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  recs_2015_hid weight rep_1   sizeofgarage           recs_iecc_zone</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         <span class="dv">10001</span>  <span class="dv">12090</span> <span class="dv">16560</span> Two<span class="sc">-</span>car garage IECC climate zones 3B<span class="sc">-</span>4B</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="dv">10002</span>  <span class="dv">14400</span> <span class="dv">21500</span>      No garage IECC climate zones 1A<span class="sc">-</span>2A</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">10003</span>  <span class="dv">23330</span> <span class="dv">12300</span>      No garage     IECC climate zone 3A</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>         <span class="dv">10004</span>  <span class="dv">12170</span> <span class="dv">18550</span> Two<span class="sc">-</span>car garage     IECC climate zone 4A</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>         <span class="dv">10005</span>  <span class="dv">16720</span>  <span class="dv">8080</span> One<span class="sc">-</span>car garage     IECC climate zone 5A</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>         <span class="dv">10006</span>  <span class="dv">26060</span> <span class="dv">37000</span>      No garage IECC climate zones 6A<span class="sc">-</span>6B</span></code></pre></div>
<p>Notice that the household ID variable has a standardized name (“recs_2015_hid”), as does the observation weights column (“weight”) and the first of the 96 replicate weights (“rep_1”). If the microdata consisted of person-level observations nested within households (e.g. as in the ACS), it would have have an additional “pid” integer variable to uniquely identify each person within the household.</p>
<p>In the case of “sizeofgarage” (the original variable name in RECS), the raw data contained NA’s (valid “skips”) for households without a garage. Those blanks are replaced with an intelligible label (“No garage”). In addition, “sizeofgarage” is classed as an ordered factor, since the labels have a natural ordering.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">recs</span><span class="op">$</span><span class="va">sizeofgarage</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"ordered"</span> <span class="st">"factor"</span> </span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">recs</span><span class="op">$</span><span class="va">sizeofgarage</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"No garage"</span>                <span class="st">"One-car garage"</span>          </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>] <span class="st">"Two-car garage"</span>           <span class="st">"Three-or-more-car garage"</span></span></code></pre></div>
<p>The variable “recs_iecc_zone” tells us something about each respondent’s location (<a href="https://basc.pnnl.gov/images/iecc-climate-zone-map" class="external-link">IECC climate zone</a>). This and other spatially-referenced variables are defined and named to be consistent with variables in the <code>geo-processed/concordance/geo_concordance.fst</code> file. This allows subsequent operations to intelligently impute respondent location prior to fusion. More details on spatial data and location imputation can be found in subsequent sections.</p>
<p>It is important that the location variables in a donor survey be precisely consistent with those defined in <code>geo_concordance.fst</code>. The latter file can be modified, if necessary, to add new location variables to allow such concordance. It is only strictly necessary that the donor survey include the variable (or set of variables) that provide maximum information about respondent location. For example, if a survey contained a “county” variable, there is no reason to include “state” – though the code shouldn’t break if it is included.</p>
<p>Some surveys (like RECS) have a complicated combination of location variables that collectively define respondent location through their spatial intersection. fusionData’s code base automatically handles this, provided that the location variables are consistent (i.e. same name and levels) in both the donor microdata and the <code>geo_concordance.fst</code> file. There is no need to specify which variables are the location variables; this is determined automatically by looking for overlap with column names in the <code>geo_concordance.fst</code> file.</p>
<p>You can see how, exactly, the raw survey data was transformed by viewing the associated code in <code>/survey-processed/RECS/2015/RECS_2015_H_processed.R</code>.</p>
<p>Given the variety of survey data structures and conventions, there is no strict procedure for how the .R file(s) should be written. However, there are common steps and tools likely to be applicable to most surveys. The <code>RECS_2015_H_processed.R</code> script is a good “template” in this regard, since it includes many common operations – including imputation of NA’s using the provided <code>imputeMissing()</code> function.</p>
<p>The RECS 2015 has a comparatively simple microdata and documentation structure: household-level microdata in a single .csv file with an associated .xls codebook. Other surveys require more complex steps to assemble the necessary microdata. There is no limit on the number or nature of .R files that can be used to ingest a survey. If multiple .R files are used, the file names should include a two-digit sequence at the front to indicate the order in which the scripts are employed (<code>01*.R</code>, <code>02*.R</code>, etc.).</p>
<p><em>The .R files should include liberal use of comments to help others understand the code later. Good practice is for comments to explain <strong>why</strong> a piece of code is included, not just <strong>what</strong> it does.</em></p>
<p>In all cases, the .R script that eventually saves the <code>_processed.fst</code> microdata file to disk must include the use of <code><a href="https://larmarange.github.io/labelled/reference/var_label.html" class="external-link">labelled::set_variable_labels</a></code> to assign variable descriptions (ideally, taken from the official codebook) for each column. The script must then call the <code><a href="reference/createDictionary.html">createDictionary()</a></code> function to create and save a standardized “dictionary.rds” file. <code><a href="reference/createDictionary.html">createDictionary()</a></code> uses the assigned variable descriptions and other information in the microdata to build the dictionary in a standardized way. You can see this at the end of <a href="https://github.com/ummel/fusionData/blob/master/survey-processed/RECS/2015/RECS_2015_H_processed.R" class="external-link">RECS_2015_H_processed.R</a>:</p>
<p>Here is the resulting dictionary file for RECS 2015.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recs.dictionary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"survey-processed/RECS/2015/RECS_2015_H_dictionary.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">recs.dictionary</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 × 8</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  survey vintage respondent variable  description             values type      n</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>  <span class="er">&lt;</span>chr<span class="sc">&gt;</span>   <span class="er">&lt;</span>chr<span class="sc">&gt;</span>      <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>                   <span class="er">&lt;</span>chr<span class="sc">&gt;</span>  <span class="er">&lt;</span>chr<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> RECS   <span class="dv">2015</span>    H          adqinsul  Level of insulation     [Not … ord    <span class="dv">5686</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> RECS   <span class="dv">2015</span>    H          agecdryer Age of clothes dryer    [No c… ord    <span class="dv">5686</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> RECS   <span class="dv">2015</span>    H          agecenac  Age of central air con… [No c… ord    <span class="dv">5686</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> RECS   <span class="dv">2015</span>    H          agecwash  Age of clothes washer   [No c… ord    <span class="dv">5686</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> RECS   <span class="dv">2015</span>    H          agedw     Age of dishwasher       [No d… ord    <span class="dv">5686</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> RECS   <span class="dv">2015</span>    H          agefrzr   Age of most<span class="sc">-</span>used freez… [No f… ord    <span class="dv">5686</span></span></code></pre></div>
<p>In practice, there is no reason for a typical user to ever open a survey’s dictionary file. The preferred and much more useful way to explore survey metadata and variable descriptions is via the <code><a href="reference/universe.html">universe()</a></code> function described in the next section.</p>
</div>
<div class="section level2">
<h2 id="document-variables">Document variables<a class="anchor" aria-label="anchor" href="#document-variables"></a>
</h2>
<p>The previous section showed how and where a survey’s “dictionary.rds” file(s) are created. Whenever a dictionary file is added or updated, it is necessary to run the <code><a href="reference/compileDictionary.html">compileDictionary()</a></code> function to compile all of fusionData’s individual survey dictionaries into a single “universal” dictionary. The usage is straightforward:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/compileDictionary.html">compileDictionary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>As the console output reveals, <code><a href="reference/compileDictionary.html">compileDictionary()</a></code> updates two files: <code>data/dictionary.rda</code> and <code>data/surveys.rda</code>. These files are part of the Github repository and are used by both the “Universal Survey Dictionary” and “Survey Harmonization Tool” Shiny apps that are part of fusionData.</p>
<p>The “Universal Survey Dictionary” is a Shiny app that can be accessed by the following call:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open "Universal Survey Dictionary" Shiny app</span></span>
<span><span class="fu"><a href="reference/universe.html">universe</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will open the app in a browser window. The tool allows the “universe” of available variables – across all ingested surveys – to be sorted and searched. A user should consult the universal dictionary after initial ingestion of a new survey, because it is an effective way to identify variables that need additional editing.</p>
</div>
<div class="section level2">
<h2 id="harmonize-variables">Harmonize variables<a class="anchor" aria-label="anchor" href="#harmonize-variables"></a>
</h2>
<p>Once a donor survey has been successfully ingested and documented, it is possible to start thinking about how to fuse that survey to the ACS.</p>
<p>The statistical linchpin of the fusion process is the set of “harmonized” variables common to a donor survey and the ACS. Identifying conceptually similar variables across surveys and determining how they can be modified to measure similar concepts is one of the most important steps in the process. It is also potentially time-consuming and error-prone.</p>
<p>The “Survey Harmonization Tool” was created to make this process easier and safer. It is a Shiny app that makes it easier to detect, specify, and save “harmonies” constructed between variables in donor surveys and variables in the ACS. The app launches in a browser window with the following call:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Open "Survey Harmonization Tool" Shiny app</span></span>
<span><span class="fu"><a href="reference/harmony.html">harmony</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At present, the <code><a href="reference/harmony.html">harmony()</a></code> app only allows specification of harmonies between a non-ACS donor survey and a specific ACS vintage (e.g. harmonizing 2015 RECS to 2015 ACS).</p>
<p>Construction of a harmony generally follows these steps:</p>
<ol style="list-style-type: decimal">
<li>Select a donor survey and vintage.</li>
<li>Select the recipient ACS vintage.</li>
<li>Select a “Donor variable” from the drop down list. The list is searchable to help locate variables associated with certain words.</li>
<li>Select a “ACS variable” to use for the “other side” of the harmony.</li>
<li>For <em>factor</em> variables, edit the “Group” columns in the spreadsheet objects to create the maximum-resolution harmony between the two variables. You can see the “live” outcome of the specified harmonization strategy in the table at the bottom of the page. For <em>continuous</em> variables, no additional modification is needed as long as the two variables measure similar concepts.</li>
<li>Once the harmony is specified as you like, click “Submit harmony”. The button only becomes available to click if minimal safety checks are passed for a valid harmony.</li>
</ol>
<p>When a user clicks “Submit harmony”, the currently-specified harmony (as defined by the selected variables and settings) is saved to disk. Specifically, the details of that particular harmony are added to the appropriate .R “harmony file” located at <code>/harmony/harmonies</code>. For example, the file describing how to harmonize RECS 2015 and ACS 2015 variables is <a href="https://github.com/ummel/fusionData/blob/master/harmony/harmonies/RECS_2015__ACS_2015.R" class="external-link">RECS_2015__ACS_2015.R</a>.</p>
<p>You should receive a pop-up message indicating if the harmony was successfully added to the local .R harmony file (it will be created, if necessary). You can confirm the harmony was added by selecting the “View harmonies” panel.</p>
<p>Probably the easiest way to become an expert with the app is to view existing harmonies that I’ve already constructed for the RECS and CEI. This will show you the settings used and give you a sense of how and why they were used.</p>
<hr>
<p>Additional details regarding “advanced” settings and examples. This may all seem convoluted at first. But once you understand what these fields are doing, it becomes quite easy, fast, and (almost) fun to construct harmonies.</p>
<p><em>Bin breakpoints</em></p>
<p>The Bin breakpoints field is used to specify how a continuous variable should be “binned” to turn it into a categorical variable – usually to allow for harmonization with a factor variable in the other survey. This is useful when an identical concept is measured on a continuous scale in one survey (e.g. income in dollars) and as a factor variable in the other survey (e.g. income range).</p>
<p>Example: Select “moneypy” for RECS 2015 to see how the ACS “hincp” is binned to create harmony.</p>
<p><em>Adjustment</em></p>
<p>The Adjustment field provides a powerful way to modify or adjust variables to accommodate non-standard harmonies. Text in the Adjustment field is passed as-is to a dplyr::mutate() call within <code><a href="reference/harmonize.html">harmonize()</a></code> that modifies the associated variable prior to any other manipulation. The text passed to the mutate() call can utilize any other variables in the microdata. This is quite powerful and allows for complicated harmonies to be accommodated.</p>
<p>Example: Select “vehq” for CEI 2015-2019. In this case, the “vehq” (owned vehicles) and “vehql” (leased vehicles) variables in the CEI – both continuous – are added together by specifying “vehq + vehql” in the Adjustment field. The result is then binned to create harmony with the ACS “veh” variable, which is a factor variable referring to all available vehicles, whether owned or leased.</p>
<p><em>Household aggregator</em></p>
<p>Sometimes it is possible to create harmony between a household-level (“H”) donor variable and a person-level (“P”) ACS variable, provided that the latter is <em>aggregated</em> at the household level. In such cases, the “Household aggregator” field tells <code><a href="reference/harmonize.html">harmonize()</a></code> how to aggregate or summarize the person-level ACS variable within each household. This field is only applicable when the donor variable is a household variable and the selected ACS variable is person-level (person-level donor variables can always be harmonized directly with person-level ACS variables).</p>
<p>Simple example: Select “hhage” for RECS 2015 (Respondent/head-of-household age). The ACS “agep” variable can be used to create harmony, but it is a person-level variable. By setting the Household aggregator field to “reference” we instruct <code><a href="reference/harmonize.html">harmonize()</a></code> to use the “reference person” value for “agep” to create a household-level variable analogous to “hhage”.</p>
<p>Advanced example: Select “numchild” for RECS 2015 (Number of household members age 17 or younger). The ACS “agep” variable can be used to create harmony. Bin breakpoints are used to re-assign each household member “agep” value to 1 if less than 18 and 0 if 18 or more (see the “Group” column in the associated spreadsheet). The Household aggregator field is the set to “sum” to instruct <code><a href="reference/harmonize.html">harmonize()</a></code> to sum these values at the household level, which creates harmony with “numchild”.</p>
<p>Very advanced example: Select “as_comp1” for CEI 2015-2019 (Number of males age 16 and over). Again, the ACS “agep” variable can be used to create harmony (as above for “numchild”), but we need to additionally restrict the harmony to males only. This is done by using the Adjustment field to first set “agep” to 0 for all females, <em>then</em> bin the result, <em>then</em> sum at the household level.</p>
<p><em>Comments</em></p>
<p>The Comments field is used to leave helpful information about why the harmony was constructed as it was. Any harmony that makes use of one of the “advanced” settings should probably have a comment explaining the rationale.</p>
<hr>
<p>A harmony file can be <code>dget</code>-d to return a list of lists, where each element defines a harmony. Like this one, defining the harmony between the “fuelheat” variable in the RECS and the “hfl” variable in the ACS.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fuelheat__hfl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>RECS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>groups <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,</span>
<span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Do not use space heating"</span>, <span class="st">"Electricity"</span>, <span class="st">"Fuel oil/kerosene"</span>, <span class="st">"Natural gas from underground pipes"</span>, <span class="st">"Propane (bottled gas)"</span>, <span class="st">"Some other fuel"</span>, <span class="st">"Wood (cordwood or pellets)"</span><span class="op">)</span>,</span>
<span>breaks <span class="op">=</span> <span class="st">""</span>,</span>
<span>adj <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>ACS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bottled, tank, or LP gas"</span>, <span class="st">"Coal or coke"</span>, <span class="st">"Electricity"</span>, <span class="st">"Fuel oil, kerosene, etc."</span>, <span class="st">"No fuel used"</span>, <span class="st">"Other fuel"</span>, <span class="st">"Solar energy"</span>, <span class="st">"Utility gas"</span>, <span class="st">"Wood"</span><span class="op">)</span>,</span>
<span>breaks <span class="op">=</span> <span class="st">""</span>,</span>
<span>adj <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>ordered <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>comment <span class="op">=</span> <span class="st">""</span>,</span>
<span>modified <span class="op">=</span> <span class="st">"2021-07-03 12:10:17"</span><span class="op">)</span></span></code></pre></div>
<p>This list object contains all of the information necessary to construct RECS and ACS microdata containing a new variable called “fuelheat__hfl”; i.e. the harmonized version of the two associated heating fuel variables. This is precisely what the <code><a href="reference/harmonize.html">harmonize()</a></code> function does – typically when called by <code><a href="reference/prepare.html">prepare()</a></code> as explained below – using all of the harmonies available in the specified harmony file. Note that harmonized variables are always indicated by a double-underscore (“__“).</p>
<p>Using the <code><a href="reference/harmony.html">harmony()</a></code> app to manually define harmonies and then letting <code><a href="reference/harmonize.html">harmonize()</a></code> take care of subsequent data manipulation makes the construction of harmonized microdata easier, faster, and <em>much</em> safer. It is generally advisable to use the <code><a href="reference/harmonize.html">harmonize()</a></code> app to create and edit harmonies. It is also possible to manually edit the .R harmony files, if necessary, but be careful.</p>
<p>Most users will eventually find themselves constructing harmonies via the app and, as a result, modifying their <em>local</em> version of .R harmony files. This means you must commit and push those changes for them to show up in the Github repository – and become available for others to use. This also means it is important to pull the most recent version of the repository when you begin working with fusionData. Otherwise, you risk duplicating the efforts of someone else and/or failing to make use of the most recent version of harmony (and other) files.</p>
</div>
<div class="section level2">
<h2 id="compile-spatial-data">Compile spatial data<a class="anchor" aria-label="anchor" href="#compile-spatial-data"></a>
</h2>
<p>fusionData allows for spatially-referenced data to be merged with survey microdata, thereby expanding the set of potential predictor variables available in the fusion process. The geographic “unit of analysis” in this case consists of <a href="https://www.census.gov/programs-surveys/geography/guidance/geo-areas/pumas.html" class="external-link">PUMA’s</a>, which are observed for ACS households and can be imputed for donor households.</p>
<p>Ingestion of spatial datasets is generally less onerous than for survey data; there are fewer requirements that the processed data must meet. The general strategy will look familiar: Raw spatial data is stored in <code>/geo-raw</code>. The raw data is transformed to a “*_processed.rds” file stored in <code>/geo-processed</code>. The associated .R file is stored in the same location.</p>
<p>A processed spatial .rds file has only two hard requirements it must meet.</p>
<ol style="list-style-type: decimal">
<li>It must contain a “vintage” column indicating the time period of each observation. The vintage can be a year, a year range (“2015-2016”), or the special value “always”. The “always” value indicates that a measurement is time-invariant (e.g. a long-term climate “normal”).</li>
<li>It must contain a column (or columns) whose name and values are also found in the <code>geo_concordance.fst</code> file. These columns define the location of the measurement and – via the <code>geo_concordance.fst</code> file – are mapped to PUMA’s.</li>
</ol>
<p>Ordered factor variables should be classed as such; other categorical variables can be character. It is <em>not</em> (currently) necessary to document the variables, name them a certain way, or create a dictionary. Let’s look at an example.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">irs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"geo-processed/IRS-SOI/IRS-SOI_2018_processed.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">irs</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 6 × 5</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  zcta10 vintage <span class="st">`</span><span class="at">Mean income per return</span><span class="st">`</span> <span class="st">`</span><span class="at">Mean income per person</span><span class="st">`</span> Mean people…¹</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>    <span class="er">&lt;</span>int<span class="sc">&gt;</span>                    <span class="er">&lt;</span>int<span class="sc">&gt;</span>                    <span class="er">&lt;</span>int<span class="sc">&gt;</span>         <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">35004</span>     <span class="dv">2018</span>                    <span class="dv">58600</span>                    <span class="dv">28760</span>          <span class="fl">2.04</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">35005</span>     <span class="dv">2018</span>                    <span class="dv">41200</span>                    <span class="dv">21200</span>          <span class="fl">1.94</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">35006</span>     <span class="dv">2018</span>                    <span class="dv">53100</span>                    <span class="dv">25300</span>          <span class="fl">2.10</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">35007</span>     <span class="dv">2018</span>                    <span class="dv">62300</span>                    <span class="dv">29240</span>          <span class="fl">2.13</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">35010</span>     <span class="dv">2018</span>                    <span class="dv">52900</span>                    <span class="dv">25700</span>          <span class="fl">2.06</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">35014</span>     <span class="dv">2018</span>                    <span class="dv">50300</span>                    <span class="dv">25900</span>          <span class="fl">1.94</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># … with abbreviated variable name ¹​`Mean people per return`</span></span></code></pre></div>
<p>The <code>irs</code> object contains processed spatial data constructed from the <a href="https://www.irs.gov/statistics/soi-tax-stats-individual-income-tax-statistics-zip-code-data-soi" class="external-link">IRS Statistics of Income (SOI)</a> zip code tax return data for 2018. The underlying raw data is stored remotely at <code>/geo-raw/IRS-SOI/2018</code>. The script used to create the “processed.rds” file is <a href="https://github.com/ummel/fusionData/blob/master/geo-processed/IRS-SOI/IRS-SOI_AllVintages_processed.R" class="external-link">available here</a>. The “zcta10” column indicates the Zip Code Tabulation Area (circa 2010) associated with each observation.</p>
<p>The “zcta10” variable is also found in the “geo_concordance.fst” file, which contains information about how to link geographic units to PUMA’s. Its creation relies heavily on data from the Missouri Census Data Center’s <a href="https://mcdc.missouri.edu/applications/geocorr.html" class="external-link">Geocorr engine</a>. The information on how to link zip codes to PUMA’s is used to aggregate the IRS-SOI data to PUMA-level prior to merging with survey microdata.</p>
<p>The <code>geo_concordance.fst</code> file contains a variety of variables that can be used to identify the location of observations in a processed spatial data file. Most of these are <a href="https://mcdc.missouri.edu/applications/docs/maggot2014.html" class="external-link">documented by Geocorr</a>. Others were added within the <a href="https://github.com/ummel/fusionData/blob/master/geo-processed/concordance/geo_concordance.R" class="external-link"><code>geo-processed/concordance/geo_concordance.R</code></a> file to allow concordance with variables found in particular datasets. The concordance file can be expanded over time as necessary.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">concordance</span> <span class="op">&lt;-</span> <span class="fu">fst</span><span class="fu">::</span><span class="fu"><a href="http://www.fstpackage.org/reference/fst.html" class="external-link">fst</a></span><span class="op">(</span><span class="st">"geo-processed/concordance/geo_concordance.fst"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">concordance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">"puma10"</span>           <span class="st">"puma_weight"</span>      <span class="st">"state"</span>            <span class="st">"state_name"</span>      </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">"state_postal"</span>     <span class="st">"county10"</span>         <span class="st">"cousubfp10"</span>       <span class="st">"tract10"</span>         </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">"bg10"</span>             <span class="st">"zcta10"</span>           <span class="st">"cbsa10"</span>           <span class="st">"cbsatype10"</span>      </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">13</span>] <span class="st">"metdiv10"</span>         <span class="st">"csa10"</span>            <span class="st">"sldu10"</span>           <span class="st">"sldl10"</span>          </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">17</span>] <span class="st">"sdbest10"</span>         <span class="st">"sdbesttype10"</span>     <span class="st">"sldu12"</span>           <span class="st">"sldl12"</span>          </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span>] <span class="st">"ur12"</span>             <span class="st">"ua12"</span>             <span class="st">"cbsa13"</span>           <span class="st">"cbsatype13"</span>      </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">25</span>] <span class="st">"metdiv13"</span>         <span class="st">"csa13"</span>            <span class="st">"county14"</span>         <span class="st">"cousubfp14"</span>      </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>[<span class="dv">29</span>] <span class="st">"sldu14"</span>           <span class="st">"sldl14"</span>           <span class="st">"sdbest14"</span>         <span class="st">"sdbesttype14"</span>    </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">33</span>] <span class="st">"cbsa15"</span>           <span class="st">"cbsatype15"</span>       <span class="st">"metdiv15"</span>         <span class="st">"csa15"</span>           </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>[<span class="dv">37</span>] <span class="st">"sldu16"</span>           <span class="st">"sldl16"</span>           <span class="st">"cd111"</span>            <span class="st">"cd113"</span>           </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">41</span>] <span class="st">"cd114"</span>            <span class="st">"cd115"</span>            <span class="st">"cd116"</span>            <span class="st">"region"</span>          </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>[<span class="dv">45</span>] <span class="st">"division"</span>         <span class="st">"recs_domain"</span>      <span class="st">"recs_division"</span>    <span class="st">"recs_ba_zone"</span>    </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">49</span>] <span class="st">"recs_iecc_zone"</span>   <span class="st">"climate_division"</span></span></code></pre></div>
<p>In some cases, the spatial dataset’s processed .rds file will include multiple location variables that are used collectively to achieve spatial concordance. For example, a spatial dataset with block group observations must include columns for “state”, “county10”, “tract10”, and “bg10” in order to allow a smooth merge with the concordance file (this is the case for the EPA-SLD dataset).</p>
<p>Unlike with processed <em>survey</em> data, the naming convention for processed spatial data files is quite relaxed. The function <code><a href="reference/compileSpatial.html">compileSpatial()</a></code> automatically detects and compiles all files in <code>/geo-processed</code> ending with “_processed.rds”. As long as a processed spatial data file has the necessary suffix – and meets the two hard requirements mentioned above – it will be compiled into the <code>geo_predictors.fst</code> file.</p>
<p>Whenever a processed .rds file is added or updated, it is necessary to run <code><a href="reference/compileSpatial.html">compileSpatial()</a></code> to update the <code>geo_predictors.fst</code> file.</p>
<p>The <code>geo_predictors.fst</code> file contains all variables and vintages across available spatial datasets, aggregated to PUMA-level in preparation for merging with survey microdata. The structure of this file is unusual, but it is not intended to be worked with directly. It is designed to allow the <code><a href="reference/assemble.html">assemble()</a></code> function (demonstrated below) to efficiently read the necessary data from disk when it merges spatial variables for particular donor and recipient surveys.</p>
<p>Consequently, unless a user is actively adding or editing processed spatial data, the only “geo files” that are strictly necessary for the fusion process are <code>geo_predictors.fst</code> and <code>geo_concordance.fst</code>, both of which can be obtained by calling <code>getGeoProcessed(dataset = "essential")</code>.</p>
</div>
<div class="section level2">
<h2 id="prepare-fusion-inputs">Prepare fusion inputs<a class="anchor" aria-label="anchor" href="#prepare-fusion-inputs"></a>
</h2>
<p>Once a donor survey is successfully ingested and harmonized, it is possible to move on to the final step: fusion! The fusion process consists of two parts. First, the necessary “input” data files are prepared. Second, those inputs are used to generate the final fusion “output”.</p>
<p>As of fusionData v1.0, these two steps are helpfully wrapped into the <code><a href="reference/fusionInput.html">fusionInput()</a></code> and <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> functions, respectively. These functions safely execute all of the steps required for successful fusion. In practice, users need only call the two high-level functions and ensure that the resulting console output and log files look good.</p>
<p>For a worked example, let’s prepare the required inputs for fusion of the RECS 2015 to the ACS 2015 (in test mode, of course!). This requires the processed microdata for both surveys to be present in your local <code>/fusionData</code> installation. If you haven’t already, you can download these files using:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/getSurveyProcessed.html">getSurveyProcessed</a></span><span class="op">(</span>survey <span class="op">=</span> <span class="st">"RECS_2015"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/getSurveyProcessed.html">getSurveyProcessed</a></span><span class="op">(</span>survey <span class="op">=</span> <span class="st">"ACS_2015"</span><span class="op">)</span></span></code></pre></div>
<p>You will also need to install the <a href="https://github.com/ummel/fusionModel" class="external-link">fusionModel package</a>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ummel/fusionModel"</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s make a call to <code><a href="reference/fusionInput.html">fusionInput()</a></code>. The function arguments are fully documented in <code><a href="reference/fusionInput.html">?fusionInput</a></code>. If you run this code in an interactive session, you will be prompted at the console to approve certain steps before proceeding (again, this is all documented). The console output is designed to be very informative and describe what is being done behind the scenes.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fusionInput.html">fusionInput</a></span><span class="op">(</span>donor <span class="op">=</span> <span class="st">"RECS_2015"</span>,</span>
<span>                         recipient <span class="op">=</span> <span class="st">"ACS_2015"</span>,</span>
<span>                         respondent <span class="op">=</span> <span class="st">"household"</span>,</span>
<span>                         fuse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"btung"</span>, <span class="st">"btuel"</span>, <span class="st">"cooltype"</span><span class="op">)</span>,</span>
<span>                         force <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"moneypy"</span>, <span class="st">"householder_race"</span>, <span class="st">"education"</span>, <span class="st">"nhsldmem"</span>, <span class="st">"kownrent"</span>, <span class="st">"recs_division"</span><span class="op">)</span>,</span>
<span>                         note <span class="op">=</span> <span class="st">"Hello world. This is a worked example for the package README!"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2023-03-30</span> <span class="dv">16</span><span class="sc">:</span><span class="dv">39</span><span class="sc">:</span><span class="dv">06</span> MDT </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>R version <span class="dv">4</span>.<span class="fl">2.3</span> (<span class="dv">2023-03-15</span>) </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>Platform<span class="sc">:</span> x86_64<span class="sc">-</span>pc<span class="sc">-</span>linux<span class="sc">-</span>gnu </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>fusionData v1.<span class="fl">0.0</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>fusionModel v2.<span class="fl">2.2</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionInput</span>(<span class="at">donor =</span> <span class="st">"RECS_2015"</span>, <span class="at">recipient =</span> <span class="st">"ACS_2015"</span>, <span class="at">respondent =</span> <span class="st">"household"</span>, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fuse =</span> <span class="fu">c</span>(<span class="st">"btung"</span>, <span class="st">"btuel"</span>, <span class="st">"cooltype"</span>), <span class="at">force =</span> <span class="fu">c</span>(<span class="st">"moneypy"</span>, </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"householder_race"</span>, <span class="st">"education"</span>, <span class="st">"nhsldmem"</span>, <span class="st">"kownrent"</span>, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recs_division"</span>), <span class="at">note =</span> <span class="st">"Hello world. This is a worked example for the package README!"</span>, </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_mode =</span> <span class="cn">TRUE</span>, <span class="at">ncores =</span> <span class="fu">getOption</span>(<span class="st">"fusionData.cores"</span>))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionInput</span>() is running <span class="cf">in</span> TEST mode.</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>User<span class="sc">-</span>supplied note<span class="sc">:</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a> Hello world. This is a worked example <span class="cf">for</span> the package README<span class="sc">!</span> </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>Result files will be saved to<span class="sc">:</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionData<span class="sc">/</span>fusion_<span class="sc">/</span>RECS<span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span>H<span class="sc">/</span>input </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>The local <span class="sc">/</span>input directory already exists.</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Check <span class="cf">for</span> custom pre<span class="sc">-</span>processing script <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>None found.</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> <span class="fu">prepare</span>() microdata <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>Harmonizing <span class="fu">RECS_2015</span> (donor) microdata at household level</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>Harmonizing <span class="fu">ACS_2015</span> (recipient) microdata at household level</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>Identified <span class="dv">124</span> geographic intersections <span class="cf">in</span> the donor...</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>Imputing PUMA <span class="cf">for</span> donor observations...</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>Assigning location variables to recipient observations...</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> <span class="fu">assemble</span>() microdata <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>Identifying donor fusion variables...</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>Including the following fusion variables<span class="sc">:</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a> btuel, btung, cooltype </span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>Applying integer scaling to spatial predictor variables...</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>Merging donor spatial predictor variables...</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>Merging recipient spatial predictor variables...</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>Assembling output data frames...</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>Performing consistency checks...</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Check <span class="cf">for</span> custom .R scripts <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>None found.</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Check categorical harmonized variables <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>Similarity scores <span class="cf">for</span> <span class="dv">18</span> categorical harmonized variables<span class="sc">:</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 18 × 2</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>   <span class="st">`</span><span class="at">Harmonized variable</span><span class="st">`</span>   <span class="st">`</span><span class="at">Similarity score</span><span class="st">`</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                                <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span> numtablet__handheld                  <span class="fl">0.676</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span> employhh__wkhp                       <span class="fl">0.727</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span> occupyyrange__mv                     <span class="fl">0.786</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span> stoven__stov                         <span class="fl">0.856</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span> ngpay__gasfp                         <span class="fl">0.868</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span> hhsex__sex                           <span class="fl">0.878</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span> moneypy__hincp                       <span class="fl">0.905</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span> fuelheat__hfl                        <span class="fl">0.929</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span> householder_race__rac1p              <span class="fl">0.933</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> internet__access                     <span class="fl">0.933</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span> education__schl                      <span class="fl">0.945</span></span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span> elpay__elefp                         <span class="fl">0.955</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a><span class="dv">13</span> kownrent__ten                        <span class="fl">0.983</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span> numfrig__refr                        <span class="fl">0.993</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a><span class="dv">15</span> typehuq__bld                         <span class="fl">0.993</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a><span class="dv">16</span> yearmaderange__ybl                   <span class="fl">0.996</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a><span class="dv">17</span> desktop__laptop                      <span class="fl">0.998</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a><span class="dv">18</span> sdescent__hisp                       <span class="fl">0.999</span></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>Retaining all categorical harmonized variables.</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Check location variables <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>The representative location variable <span class="st">'loc..recs_division'</span> has <span class="dv">10</span> levels.</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>The following location variables have been flagged <span class="cf">for</span> possible exclusion<span class="sc">:</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a><span class="co"># A tibble: 1 × 2</span></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Location variable</span><span class="st">`</span> <span class="st">`</span><span class="at">Number of levels</span><span class="st">`</span></span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                            <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> loc..recs_iecc_zone                 <span class="dv">11</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>Retaining all location variables.</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Check fusion and predictor variables <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>Identified <span class="dv">3</span> fusion <span class="fu">variables</span> (<span class="dv">0</span> blocks)<span class="sc">:</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"btung"</span>    <span class="st">"btuel"</span>    <span class="st">"cooltype"</span></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>Identified <span class="dv">24</span> harmonized variables and <span class="dv">240</span> total predictors</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>Identified <span class="dv">6</span> predictors to force and use <span class="cf">for</span> validation<span class="sc">:</span></span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"moneypy__hincp"</span>          <span class="st">"householder_race__rac1p"</span></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>] <span class="st">"education__schl"</span>         <span class="st">"nhsldmem__np"</span>           </span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>[<span class="dv">5</span>] <span class="st">"kownrent__ten"</span>           <span class="st">"loc..recs_division"</span>     </span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Run fusionModel<span class="sc">::</span><span class="fu">prepXY</span>() <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>fusionModel v2.<span class="fl">2.2</span> <span class="sc">|</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ummel<span class="sc">/</span>fusionModel</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>Missing values imputed <span class="cf">for</span> the following <span class="st">'x'</span> <span class="fu">variable</span>(s)<span class="sc">:</span></span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a> acs.sf..b060, acs.sf..b080, nrel.urdb..rsed </span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>Identifying <span class="st">'x'</span> that pass absolute Spearman correlation threshold</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>Fitting full models <span class="cf">for</span> each <span class="st">'y'</span></span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>Iteratively constructing preferred fusion order</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>Retained <span class="dv">176</span> of <span class="dv">240</span> predictor variables</span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">3.12</span> secs </span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>Results of <span class="fu">prepXY</span>() saved to<span class="sc">:</span> <span class="fu">RECS_2015_2015_H_prep.rds</span> (<span class="fl">0.00151</span> MB) </span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Write training and prediction datasets to disk <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>Writing training dataset...</span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>Training dataset saved to<span class="sc">:</span> <span class="fu">RECS_2015_2015_H_train.fst</span> (<span class="fl">1.05</span> MB) </span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>Writing prediction dataset...</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>Prediction dataset saved to<span class="sc">:</span> <span class="fu">RECS_2015_2015_H_predict.fst</span> (<span class="fl">1.76</span> MB) </span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>Test mode<span class="sc">:</span> saved partial prediction data. Expected production file size is <span class="sc">~</span> <span class="dv">216</span> MB</span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Upload <span class="sc">/</span>input files to Google Drive <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a><span class="er">|===</span> <span class="fu">fusionInput</span>() is finished<span class="sc">!</span> <span class="er">===|</span></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionInput</span>() total processing time<span class="sc">:</span> <span class="fl">33.6</span> secs </span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionInput</span>() log file saved to<span class="sc">:</span></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionData<span class="sc">/</span>fusion_<span class="sc">/</span>RECS<span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span>H<span class="sc">/</span>input<span class="sc">/</span>RECS_2015_2015_H_inputlog.txt</span></code></pre></div>
<p>Both <code><a href="reference/fusionInput.html">fusionInput()</a></code> and <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> can be run in “test mode” – in fact, this is the default behavior. When in test mode, result files are saved within the <code>/fusion_</code> directory to prevent any conflict with (or overwrite) of production data in <code>/fusion</code> (no underscore). <code><a href="reference/fusionInput.html">fusionInput()</a></code> returns the path to the directory where files are saved. We can confirm that the path used <code>/fusion_</code> as expected:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input.dir</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"/home/kevin/Documents/Projects/fusionData/fusion_/RECS/2015/2015/H/input"</span></span></code></pre></div>
<p>Note that the path includes the correct directory hierarchy. The path ends with “RECS/2015/2015/H/input” to indicate that the directory in question contains fusion input files associated with the RECS donor survey from 2015, for fusion to ACS 2015, at household-level.</p>
<p>Now let’s see the names of the files created by <code><a href="reference/fusionInput.html">fusionInput()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">input.dir</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"RECS_2015_2015_H_inputlog.txt"</span> <span class="st">"RECS_2015_2015_H_predict.fst"</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>] <span class="st">"RECS_2015_2015_H_prep.rds"</span>     <span class="st">"RECS_2015_2015_H_train.fst"</span>   </span></code></pre></div>
<p>Every call to <code><a href="reference/fusionInput.html">fusionInput()</a></code> generates the same four generic result files:</p>
<ol style="list-style-type: decimal">
<li>
<code>*_inputlog.txt</code>: A copy of the extensive console output you saw above.</li>
<li>
<code>*_prep.rds</code>: Information about the variables to be used in the eventual fusion model.</li>
<li>
<code>*_train.fst</code>: Donor survey processed and harmonized training microdata, ready for fusion.</li>
<li>
<code>*_predict.fst</code>: Recipient ACS processed and harmonized prediction microdata, ready for fusion.</li>
</ol>
<p>It is usually necessary for a user to run <code><a href="reference/fusionInput.html">fusionInput()</a></code> more than once for a given donor survey, since the process can flag issues with variable harmonization that need to be addressed before finalizing the fusion inputs.</p>
</div>
<div class="section level2">
<h2 id="generate-fusion-outputs">Generate fusion outputs<a class="anchor" aria-label="anchor" href="#generate-fusion-outputs"></a>
</h2>
<p>Once the necessary input files are ready-to-go, it is straightforward to complete the fusion process using <code><a href="reference/fusionOutput.html">fusionOutput()</a></code>. The function arguments are fully documented in <code><a href="reference/fusionOutput.html">?fusionOutput</a></code>. A minimal call simply indicates where to find the required input files. Everything else is handled automatically:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fusionOutput.html">fusionOutput</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">input.dir</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2023-03-30</span> <span class="dv">17</span><span class="sc">:</span><span class="dv">05</span><span class="sc">:</span><span class="dv">37</span> MDT </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>R version <span class="dv">4</span>.<span class="fl">2.3</span> (<span class="dv">2023-03-15</span>) </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>Platform<span class="sc">:</span> x86_64<span class="sc">-</span>pc<span class="sc">-</span>linux<span class="sc">-</span>gnu </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>fusionData v1.<span class="fl">0.0</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>fusionModel v2.<span class="fl">2.2</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionOutput</span>(<span class="at">input =</span> input.dir, <span class="at">output =</span> <span class="cn">NULL</span>, <span class="at">M =</span> <span class="cn">NULL</span>, <span class="at">note =</span> <span class="cn">NULL</span>, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_mode =</span> <span class="cn">TRUE</span>, <span class="at">upload =</span> <span class="cn">FALSE</span>, <span class="at">ncores =</span> <span class="fu">getOption</span>(<span class="st">"fusionData.cores"</span>), </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="dv">2</span>, <span class="at">... =</span> )</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionOutput</span>() is running <span class="cf">in</span> TEST mode.</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>The input files directory is<span class="sc">:</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionData<span class="sc">/</span>fusion_<span class="sc">/</span>RECS<span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span>H<span class="sc">/</span>input </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>Result files will be saved to<span class="sc">:</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionData<span class="sc">/</span>fusion_<span class="sc">/</span>RECS<span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span>H<span class="sc">/</span>output </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>The local <span class="sc">/</span>output directory already exists.</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Load training data inputs <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>Loading training microdata<span class="sc">:</span> RECS_2015_2015_H_train.fst </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>Loading <span class="fu">prepXY</span>() results<span class="sc">:</span> RECS_2015_2015_H_prep.rds </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Run fusionModel<span class="sc">::</span><span class="fu">train</span>() <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>Running <span class="cf">in</span> <span class="st">'test'</span> mode using <span class="fu">fast</span>(er) hyper<span class="sc">-</span>parameter settings<span class="sc">:</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="er">$</span>boosting</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"goss"</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>num_leaves</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">8</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>min_data_in_leaf</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">57</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>num_iterations</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">50</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>bagging_fraction</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>feature_fraction</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.3</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>learning_rate</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.2</span></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>max_depth</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">3</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>max_bin</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">16</span></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>min_data_in_bin</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">57</span></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>max_cat_threshold</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">8</span></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>Training fusion model</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>fusionModel v2.<span class="fl">2.2</span> <span class="sc">|</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ummel<span class="sc">/</span>fusionModel</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>Missing values imputed <span class="cf">for</span> the following <span class="st">'x'</span> <span class="fu">variable</span>(s)<span class="sc">:</span></span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a> acs.sf..b060, acs.sf..b080, nrel.urdb..rsed </span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> fusion variables</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a><span class="dv">176</span> initial predictor variables</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a><span class="dv">5686</span> observations</span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>Using specified set of predictors <span class="cf">for</span> each fusion variable</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>Using OpenMP multithreading within <span class="fu">LightGBM</span> (<span class="dv">3</span> cores)</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>Training step <span class="dv">1</span> of <span class="dv">3</span><span class="sc">:</span> btung</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.972</span> </span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a>   <span class="fl">10.0</span>    <span class="fl">38.0</span>   <span class="fl">122.5</span>   <span class="fl">188.1</span>   <span class="fl">343.0</span>   <span class="fl">497.0</span> </span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>Training step <span class="dv">2</span> of <span class="dv">3</span><span class="sc">:</span> cooltype</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>Training step <span class="dv">3</span> of <span class="dv">3</span><span class="sc">:</span> btuel</span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> R<span class="sc">-</span>squared of cluster means<span class="sc">:</span> <span class="fl">0.963</span> </span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Number of neighbors <span class="cf">in</span> each cluster<span class="sc">:</span></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>   <span class="fl">10.0</span>    <span class="fl">34.0</span>    <span class="fl">82.0</span>   <span class="fl">146.1</span>   <span class="fl">229.0</span>   <span class="fl">494.0</span> </span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>Fusion model saved to<span class="sc">:</span></span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionData<span class="sc">/</span>fusion_<span class="sc">/</span>RECS<span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span>H<span class="sc">/</span>output<span class="sc">/</span>RECS_2015_2015_H_model.fsn </span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">5.58</span> secs </span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Fuse onto training data <span class="cf">for</span> internal validation <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>Running <span class="cf">in</span> <span class="st">'test'</span> mode, so internal validation skipped.</span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Fuse onto prediction data <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>Loading prediction microdata<span class="sc">:</span> RECS_2015_2015_H_predict.fst </span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>Fusing to ACS <span class="fu">microdata</span> (<span class="dv">2</span> implicates)</span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> fusion variables</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a><span class="dv">176</span> initial predictor variables</span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a><span class="dv">10000</span> observations</span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>Missing values imputed <span class="cf">for</span> the following <span class="fu">variable</span>(s)<span class="sc">:</span></span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a> acs.sf..b060, acs.sf..b080, nrel.urdb..rsed </span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a>Generating <span class="dv">2</span> implicates </span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a>Using OpenMP multithreading within <span class="fu">LightGBM</span> (<span class="dv">3</span> cores)</span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>Fusion step <span class="dv">1</span> of <span class="dv">3</span><span class="sc">:</span> btung</span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>Fusion step <span class="dv">2</span> of <span class="dv">3</span><span class="sc">:</span> cooltype</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a>Fusion step <span class="dv">3</span> of <span class="dv">3</span><span class="sc">:</span> btuel</span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Predicting LightGBM models</span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a><span class="sc">--</span> Simulating fused values</span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>Writing fusion output to .fsd file </span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>Fusion results saved to<span class="sc">:</span></span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionData<span class="sc">/</span>fusion_<span class="sc">/</span>RECS<span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span>H<span class="sc">/</span>output<span class="sc">/</span>RECS_2015_2015_H_fused.fsd </span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>Total processing time<span class="sc">:</span> <span class="fl">0.78</span> secs </span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> Upload <span class="sc">/</span>output files to Google Drive <span class="sc">==</span><span class="er">=|</span></span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a><span class="st">'upload = FALSE'</span>; file upload skipped at request of user.</span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a><span class="sc">|</span><span class="er">===</span> <span class="fu">fusionOutput</span>() is finished<span class="sc">!</span> <span class="er">===|</span></span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionOutput</span>() total processing time<span class="sc">:</span> <span class="fl">6.4</span> secs </span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a><span class="fu">fusionOutput</span>() log file saved to<span class="sc">:</span></span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a> <span class="er">/</span>home<span class="sc">/</span>kevin<span class="sc">/</span>Documents<span class="sc">/</span>Projects<span class="sc">/</span>fusionData<span class="sc">/</span>fusion_<span class="sc">/</span>RECS<span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span><span class="dv">2015</span><span class="sc">/</span>H<span class="sc">/</span>output<span class="sc">/</span>RECS_2015_2015_H_outputlog.txt</span></code></pre></div>
<p>As before, let’s check the location of the result files and their names:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output.dir</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"/home/kevin/Documents/Projects/fusionData/fusion_/RECS/2015/2015/H/output"</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">output.dir</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"RECS_2015_2015_H_fused.fsd"</span>     <span class="st">"RECS_2015_2015_H_model.fsn"</span>    </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">3</span>] <span class="st">"RECS_2015_2015_H_outputlog.txt"</span></span></code></pre></div>
<p>Every call to <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> generates the same three generic result files:</p>
<ol style="list-style-type: decimal">
<li>
<code>*_outputlog.txt</code>: A copy of the extensive console output above.</li>
<li>
<code>*_model.fsn</code>: The fusionModel object used to simulate the fusion variables.</li>
<li>
<code>*_fused.fsd</code>: The recipient microdata with simulated values for the fusion variables, across multiple implicates.</li>
</ol>
<p>In addition, if <em>not</em> running in test mode, two additional files are produced:</p>
<ol style="list-style-type: decimal">
<li>
<code>*_valid.fsd</code>: The <em>training</em> microdata with simulated values for the fusion variables, across multiple implicates.</li>
<li>
<code>*_validation.rds</code>: Results from internal validation exercises using the simulated variables in <code>*_valid.fsd</code>.</li>
</ol>
<p>Just to confirm, let’s look at the final, fused microdata in “RECS_2015_2015_H_fused.fsd”.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fsd.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">output.dir</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">fused</span> <span class="op">&lt;-</span> <span class="fu">fusionModel</span><span class="fu">::</span><span class="fu">read_fsd</span><span class="op">(</span><span class="va">fsd.file</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fusionModel v2.<span class="fl">2.2</span> <span class="sc">|</span> https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>ummel<span class="sc">/</span>fusionModel</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fused</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">20000</span>     <span class="dv">4</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">fused</span><span class="op">$</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>     <span class="dv">2</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="dv">10000</span> <span class="dv">10000</span> </span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fused</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>   M  btung                                 cooltype btuel</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">139800</span>          Central air conditioning system <span class="dv">48500</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span> <span class="dv">1</span>      <span class="dv">0</span>          Central air conditioning system <span class="dv">72300</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">:</span> <span class="dv">1</span>  <span class="dv">37900</span> Individual window<span class="sc">/</span>wall or portable units <span class="dv">45000</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="sc">:</span> <span class="dv">1</span>      <span class="dv">0</span>          Central air conditioning system <span class="dv">57900</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">103600</span>          Central air conditioning system <span class="dv">29900</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="sc">:</span> <span class="dv">1</span>  <span class="dv">30000</span>          Central air conditioning system  <span class="dv">7740</span></span></code></pre></div>
<p>When running in test mode, the ACS prediction dataset is restricted to the first 10,000 rows and, by default, only two implicates are simulated (for speed and file size). This is a quick(er) way to check if there are any obvious issues or problems. It is a good idea to make sure both <code><a href="reference/fusionInput.html">fusionInput()</a></code> and <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> are “passing” start-to-finish in test mode before trying to your final (and more time-consuming) fusion.</p>
<p>In practice, we sometimes need to “do fusion” in a secure server environment. Since installing the complete fusionData package just to access <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> is overkill (and a pain), a copy of <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> is silently exported in the fusion<em>Model</em> package. This allows someone to install and load only the fusionModel package in a server environment and then use <code><a href="reference/fusionOutput.html">fusionOutput()</a></code> to do the fusion step – assuming the server has access to the necessary input files.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing fusionData</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kevin Ummel <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kevin Ummel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
